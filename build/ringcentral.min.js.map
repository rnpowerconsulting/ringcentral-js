{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6","webpack:///ringcentral.min.js","webpack:///webpack/bootstrap 14d7676e1e9def719785?2ed1","webpack:///./src/SDK.js?d032","webpack:///./~/object-assign/index.js?2927","webpack:///./src/core/Cache.js?1256","webpack:///./src/http/Client.js?4230","webpack:///./~/is-plain-object/index.js?2af1","webpack:///./~/is-plain-object/~/isobject/index.js?f4f9","webpack:///./~/events/events.js?7c71","webpack:///./src/http/ApiResponse.js?d4a4","webpack:///./~/querystring/index.js?fce8","webpack:///./~/querystring/decode.js?c250","webpack:///./~/querystring/encode.js?e86b","webpack:///./src/core/Externals.js?fdf1","webpack:///external {\"amd\":\"pubnub\"}?3fcf","webpack:///external \"es6-promise\"?008f","webpack:///external \"fetch-ponyfill\"?ca2a","webpack:///./src/platform/Platform.js?8f42","webpack:///./src/platform/Auth.js?cef5","webpack:///./src/core/Constants.js?22d0","webpack:///./package.json?70ff","webpack:///./src/subscription/Subscription.js?3ae8","webpack:///./src/subscription/CachedSubscription.js?3294"],"names":["root","factory","exports","module","require","undefined","define","amd","this","__WEBPACK_EXTERNAL_MODULE_12__","__WEBPACK_EXTERNAL_MODULE_13__","__WEBPACK_EXTERNAL_MODULE_14__","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","SDK","options","_externals","Externals","_cache","Cache","externals","cachePrefix","_client","Client","_platform","Platform","objectAssign","client","cache","Subscription","CachedSubscription","Constants","version","server","sandbox","production","prototype","platform","createSubscription","createCachedSubscription","arguments","cacheKey","toString","handleLoginRedirect","origin","response","window","location","hash","search","msg","authResponseProperty","opener","postMessage","toObject","val","TypeError","Object","shouldUseNative","assign","test1","String","getOwnPropertyNames","test2","i","fromCharCode","order2","map","n","join","test3","split","forEach","letter","keys","e","hasOwnProperty","propIsEnumerable","propertyIsEnumerable","target","source","from","symbols","to","s","length","key","getOwnPropertySymbols","_prefix","prefix","defaultPrefix","setItem","data","localStorage","_prefixKey","JSON","stringify","removeItem","getItem","item","parse","clean","indexOf","findHeaderName","name","headers","toLowerCase","reduce","res","EventEmitter","events","beforeRequest","requestSuccess","requestError","isPlainObject","ApiResponse","qs","_allowedMethods","create","sendRequest","request","apiResponse","Promise","resolve","emit","_loadResponse","bind","then","receiveResponse","ok","Error","makeError","fetch","url","originalMessage","message","error","createRequest","init","method","toUpperCase","credentials","mode","query","_jsonContentType","body","contentTypeHeaderName","_contentType","contentType","_urlencodedContentType","req","Request","originalBody","isObjectObject","o","isObject","ctor","prot","constructor","Array","isArray","_events","_maxListeners","isFunction","arg","isNumber","isUndefined","defaultMaxListeners","setMaxListeners","isNaN","type","er","handler","len","args","listeners","err","context","slice","apply","addListener","listener","newListener","push","warned","console","trace","on","once","g","removeListener","fired","list","position","splice","removeAllListeners","ret","listenerCount","evlistener","emitter","_request","_response","_text","responseText","_json","_multipart","_multipartContentType","_headerSeparator","_bodySeparator","_boundarySeparator","_unauthorizedStatus","_isMultipart","_isJson","text","json","skipOKCheck","status","statusText","error_description","description","toMultipart","multipart","boundary","_getContentType","match","parts","trim","shift","pop","statusInfo","_create","part","_isContentType","get","replace","Headers","headersAndBody","headersText","header","value","append","Response","decode","encode","obj","prop","sep","eq","regexp","maxKeys","kstr","vstr","k","v","x","idx","substr","decodeURIComponent","stringifyPrimitive","isFinite","ks","encodeURIComponent","global","PUBNUB","pubnub","es6Promise","fetchPonyfill","FetchPonyfill","beforeLogin","loginSuccess","loginError","beforeRefresh","refreshSuccess","refreshError","beforeLogout","logoutSuccess","logoutError","_server","_appKey","appKey","_appSecret","appSecret","_redirectUri","redirectUri","_refreshDelayMs","refreshDelayMs","_clearCacheOnRefreshError","clearCacheOnRefreshError","_userAgent","appName","appVersion","_refreshPromise","_auth","Auth","cacheId","_cacheId","refreshHandicapMs","_urlPrefix","_apiVersion","_tokenEndpoint","_revokeEndpoint","_authorizeEndpoint","delay","timeout","reject","setTimeout","auth","createUrl","path","builtUrl","hasHttp","addServer","addMethod","addToken","accessToken","loginUrl","response_type","implicit","redirect_uri","client_id","state","brand_id","brandId","display","prompt","parseLoginRedirect","getParts","separator","reverse","queryString","loginWindow","width","height","property","dualScreenLeft","screenLeft","screen","left","dualScreenTop","screenTop","top","innerWidth","document","documentElement","clientWidth","innerHeight","clientHeight","win","open","focus","eventMethod","addEventListener","eventRemoveMethod","messageEvent","eventListener","close","loginOptions","code","access_token","loggedIn","ensureLoggedIn","login","grant_type","username","password","extension","endpointId","endpoint_id","accessTokenTtl","refreshTokenTtl","_tokenRequest","setData","_refresh","refreshToken","refreshTokenValid","refresh_token","access_token_ttl","expires_in","refresh_token_ttl","refresh_token_expires_in","refresh","logout","token","inflateRequest","skipAuthCheck","set","_authHeader","retry","cancelAccessToken","send","post","put","_isAccessTokenValid","Authorization","_apiKey","Content-Type","accessTokenValid","apiKey","btoa","Buffer","tokenType","_refreshHandicapMs","token_type","newData","expire_time","Date","now","refresh_token_expire_time","authData","scripts","build","watch","test","mocha","mocha-watch","mocha-api","karma","karma-watch","karma-webpack","karma-webpack-watch","istanbul","tsd","start","docs","hint","dependencies","es6-promise","fetch-ponyfill","is-plain-object","object-assign","devDependencies","chai","fetch-mock","http-server","jsdoc-to-markdown","jshint","json-loader","karma-chai-plugins","karma-chrome-launcher","karma-coverage","karma-firefox-launcher","karma-html-reporter","karma-mocha","karma-mocha-reporter","karma-phantomjs-launcher","karma-sourcemap-loader","phantomjs-prebuilt","sinon","sinon-chai","soap","virtual-module-webpack-plugin","webpack","whatwg-fetch","jsdoc2md","separators","module-index-format","param-list-format","property-list-format","jshintConfig","curly","eqeqeq","expr","indent","latedef","laxbreak","plusplus","shadow","sub","preferGlobal","private","main","author","email","contributors","repository","bugs","homepage","engines","node","license","notification","removeSuccess","removeError","renewSuccess","renewError","subscribeSuccess","subscribeError","_pollInterval","pollInterval","_renewHandicapMs","renewHandicapMs","_pubnub","_pubnubLastChannel","_timeout","_subscription","subscribed","subscription","deliveryMode","subscriberKey","address","alive","expirationTime","expired","getTime","setSubscription","_clearTimeout","_setSubscription","_subscribeAtPubnub","_setTimeout","register","renew","subscribe","eventFilters","addEventFilters","setEventFilters","concat","_getFullEventFilters","transportType","reset","remove","resubscribe","filters","unsubscribe","channel","event","setInterval","clearInterval","_decrypt","encryptionKey","crypto_obj","decrypt","encryptKey","keyEncoding","keyLength","_notify","ssl","subscribe_key","ready","connect","_cacheKey","restore"],"mappings":"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","file":"ringcentral.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(undefined), require(\"es6-promise\"), require(\"fetch-ponyfill\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"pubnub\", \"es6-promise\", \"fetch-ponyfill\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SDK\"] = factory(require(undefined), require(\"es6-promise\"), require(\"fetch-ponyfill\"));\n\telse\n\t\troot[\"RingCentral\"] = root[\"RingCentral\"] || {}, root[\"RingCentral\"][\"SDK\"] = factory(root[undefined], root[\"es6-promise\"], root[\"fetch-ponyfill\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_13__, __WEBPACK_EXTERNAL_MODULE_14__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(undefined), require(\"es6-promise\"), require(\"fetch-ponyfill\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"pubnub\", \"es6-promise\", \"fetch-ponyfill\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SDK\"] = factory(require(undefined), require(\"es6-promise\"), require(\"fetch-ponyfill\"));\n\telse\n\t\troot[\"RingCentral\"] = root[\"RingCentral\"] || {}, root[\"RingCentral\"][\"SDK\"] = factory(root[undefined], root[\"es6-promise\"], root[\"fetch-ponyfill\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_12__, __WEBPACK_EXTERNAL_MODULE_13__, __WEBPACK_EXTERNAL_MODULE_14__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/build/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n/**\n * @namespace RingCentral\n */\nvar objectAssign = __webpack_require__(1);\nvar Cache = __webpack_require__(2);\nvar Client = __webpack_require__(3);\nvar Externals = __webpack_require__(11);\nvar Platform = __webpack_require__(15);\nvar Subscription = __webpack_require__(19);\nvar CachedSubscription = __webpack_require__(20);\nvar Constants = __webpack_require__(17);\n\n/**\n * @constructor\n * @param {string} options.server\n * @param {string} options.appSecret\n * @param {string} options.appKey\n * @param {string} [options.cachePrefix]\n * @param {string} [options.appName]\n * @param {string} [options.appVersion]\n * @param {string} [options.redirectUri]\n * @param {PUBNUB} [options.PUBNUB]\n * @param {function(new:Promise)} [options.Promise]\n * @param {Storage} [options.localStorage]\n * @param {fetch} [options.fetch]\n * @param {function(new:Request)} [options.Request]\n * @param {function(new:Response)} [options.Response]\n * @param {function(new:Headers)} [options.Headers]\n * @param {int} [options.refreshDelayMs]\n * @param {int} [options.refreshHandicapMs]\n * @param {boolean} [options.clearCacheOnRefreshError]\n * @property {Externals} _externals\n * @property {Cache} _cache\n * @property {Client} _client\n * @property {Platform} _platform\n */\nfunction SDK(options) {\n\n    /** @private */\n    this._externals = new Externals(options);\n\n    /** @private */\n    this._cache = new Cache({\n        externals: this._externals,\n        cachePrefix: options.cachePrefix\n    });\n\n    /** @private */\n    this._client = new Client(this._externals);\n\n    /** @private */\n    this._platform = new Platform(objectAssign({}, options, {\n        externals: this._externals,\n        client: this._client,\n        cache: this._cache\n    }));\n\n}\n\nSDK.version = Constants.version;\n\nSDK.server = {\n    sandbox: 'https://platform.devtest.ringcentral.com',\n    production: 'https://platform.ringcentral.com'\n};\n\n/**\n * @return {Platform}\n */\nSDK.prototype.platform = function() {\n    return this._platform;\n};\n\n/**\n * @return {Cache}\n */\nSDK.prototype.cache = function() {\n    return this._cache;\n};\n\n/**\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @return {Subscription}\n */\nSDK.prototype.createSubscription = function(options) {\n    return new Subscription(objectAssign({}, options, {\n        externals: this._externals,\n        platform: this._platform\n    }));\n};\n\n/**\n * @param {string} options.cacheKey\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @return {CachedSubscription}\n */\nSDK.prototype.createCachedSubscription = function(options) {\n\n    if (typeof arguments[0] == 'string') {\n        options = {cacheKey: arguments[0].toString()};\n    } else {\n        options = options || {};\n    }\n\n    return new CachedSubscription(objectAssign({}, options, {\n        externals: this._externals,\n        platform: this._platform,\n        cache: this._cache\n    }));\n\n};\n\nSDK.handleLoginRedirect = function(origin) {\n\n    var response = window.location.hash ? window.location.hash : window.location.search;\n    var msg = {};\n    msg[Constants.authResponseProperty] = response;\n    window.opener.postMessage(msg, origin || window.location.origin);\n\n};\n\nmodule.exports = SDK;\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (e) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (Object.getOwnPropertySymbols) {\n\t\t\tsymbols = Object.getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n/**\n * @param {Externals} options.externals\n * @param {string} [options.prefix]\n * @property {Externals} _externals\n */\nfunction Cache(options) {\n\n    /** @private */\n    this._prefix = options.prefix || Cache.defaultPrefix;\n\n    /** @private */\n    this._externals = options.externals;\n\n}\n\nCache.defaultPrefix = 'rc-';\n\nCache.prototype.setItem = function(key, data) {\n    this._externals.localStorage[this._prefixKey(key)] = JSON.stringify(data);\n    return this;\n};\n\nCache.prototype.removeItem = function(key) {\n    delete this._externals.localStorage[this._prefixKey(key)];\n    return this;\n};\n\nCache.prototype.getItem = function(key) {\n    var item = this._externals.localStorage[this._prefixKey(key)];\n    if (!item) return null;\n    return JSON.parse(item);\n};\n\nCache.prototype.clean = function() {\n\n    for (var key in this._externals.localStorage) {\n\n        if (!this._externals.localStorage.hasOwnProperty(key)) continue;\n\n        if (key.indexOf(this._prefix) === 0) {\n            delete this._externals.localStorage[key];\n        }\n\n    }\n\n    return this;\n\n};\n\nCache.prototype._prefixKey = function(key) {\n    return this._prefix + key;\n};\n\nmodule.exports = Cache;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\nvar isPlainObject = __webpack_require__(4);\nvar EventEmitter = __webpack_require__(6).EventEmitter;\nvar ApiResponse = __webpack_require__(7);\nvar qs = __webpack_require__(8);\n\nfunction findHeaderName(name, headers) {\n    name = name.toLowerCase();\n    return Object.keys(headers).reduce(function(res, key) {\n        if (res) return res;\n        if (name == key.toLowerCase()) return key;\n        return res;\n    }, null);\n}\n\n/**\n * @param {Externals} externals\n * @property {Externals} _externals\n */\nfunction Client(externals) {\n\n    EventEmitter.call(this);\n\n    /** @private */\n    this._externals = externals;\n\n    this.events = {\n        beforeRequest: 'beforeRequest',\n        requestSuccess: 'requestSuccess',\n        requestError: 'requestError'\n    };\n\n}\n\nClient._allowedMethods = ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS', 'HEAD'];\n\nClient.prototype = Object.create(EventEmitter.prototype);\n\n/**\n * @param {Request} request\n * @return {Promise<ApiResponse>}\n */\nClient.prototype.sendRequest = function(request) {\n\n    var apiResponse = new ApiResponse({\n        externals: this._externals,\n        request: request\n    });\n\n    return (new this._externals.Promise(function(resolve) {\n\n        //TODO Stop request if listeners return false\n        this.emit(this.events.beforeRequest, apiResponse);\n\n        resolve(this._loadResponse(request));\n\n    }.bind(this))).then(function(response) {\n\n        return apiResponse.receiveResponse(response);\n\n    }).then(function() {\n\n        if (!apiResponse.ok()) throw new Error('Response has unsuccessful status');\n\n        this.emit(this.events.requestSuccess, apiResponse);\n\n        return apiResponse;\n\n    }.bind(this)).catch(function(e) {\n\n        if (!e.apiResponse) e = this.makeError(e, apiResponse);\n\n        this.emit(this.events.requestError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @param {Request} request\n * @return {Promise<Response>}\n * @private\n */\nClient.prototype._loadResponse = function(request) {\n    return this._externals.fetch.call(null, request.url, request);\n};\n\n/**\n * Wraps the JS Error object with transaction information\n * @param {Error|IApiError} e\n * @param {ApiResponse} apiResponse\n * @return {IApiError}\n */\nClient.prototype.makeError = function(e, apiResponse) {\n\n    // Wrap only if regular error\n    if (!e.hasOwnProperty('apiResponse') && !e.hasOwnProperty('originalMessage')) {\n\n        e.apiResponse = apiResponse;\n        e.originalMessage = e.message;\n        e.message = (apiResponse && apiResponse.error(true)) || e.originalMessage;\n\n    }\n\n    return e;\n\n};\n\n/**\n *\n * @param {object} init\n * @param {object} [init.url]\n * @param {object} [init.body]\n * @param {string} [init.method]\n * @param {object} [init.query]\n * @param {object} [init.headers]\n * @param {object} [init.credentials]\n * @param {object} [init.mode]\n * @return {Request}\n */\nClient.prototype.createRequest = function(init) {\n\n    init = init || {};\n    init.headers = init.headers || {};\n\n    // Sanity checks\n    if (!init.url) throw new Error('Url is not defined');\n    if (!init.method) init.method = 'GET';\n    init.method = init.method.toUpperCase();\n    if (init.method && Client._allowedMethods.indexOf(init.method) < 0) {\n        throw new Error('Method has wrong value: ' + init.method);\n    }\n\n    // Defaults\n    init.credentials = init.credentials || 'include';\n    init.mode = init.mode || 'cors';\n\n    // Append Query String\n    if (init.query) {\n        init.url = init.url + (init.url.indexOf('?') > -1 ? '&' : '?') + qs.stringify(init.query);\n    }\n\n    if (!(findHeaderName('Accept', init.headers))) {\n        init.headers['Accept'] = ApiResponse._jsonContentType;\n    }\n\n    // Serialize body\n    if (isPlainObject(init.body) || !init.body) {\n\n        var contentTypeHeaderName = findHeaderName(ApiResponse._contentType, init.headers);\n\n        if (!contentTypeHeaderName) {\n            contentTypeHeaderName = ApiResponse._contentType;\n            init.headers[contentTypeHeaderName] = ApiResponse._jsonContentType;\n        }\n\n        var contentType = init.headers[contentTypeHeaderName];\n\n        // Assign a new encoded body\n        if (contentType.indexOf(ApiResponse._jsonContentType) > -1) {\n            if ((init.method === 'GET' || init.method === 'HEAD') && !!init.body) {\n                // oddly setting body to null still result in TypeError in phantomjs\n                init.body = undefined;\n            } else {\n                init.body = JSON.stringify(init.body);\n            }\n\n        } else if (contentType.indexOf(ApiResponse._urlencodedContentType) > -1) {\n            init.body = qs.stringify(init.body);\n        }\n\n    }\n\n    // Create a request with encoded body\n    var req = new this._externals.Request(init.url, init);\n\n    // Keep the original body accessible directly (for mocks)\n    req.originalBody = init.body;\n\n    return req;\n\n};\n\n/**\n * @typedef {object} IApiError\n * @property {string} stack\n * @property {string} originalMessage\n * @property {ApiResponse} apiResponse\n */\n\nmodule.exports = Client;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nvar isObject = __webpack_require__(5);\n\nfunction isObjectObject(o) {\n  return isObject(o) === true\n    && Object.prototype.toString.call(o) === '[object Object]';\n}\n\nmodule.exports = function isPlainObject(o) {\n  var ctor,prot;\n  \n  if (isObjectObject(o) === false) return false;\n  \n  // If has modified constructor\n  ctor = o.constructor;\n  if (typeof ctor !== 'function') return false;\n  \n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObjectObject(prot) === false) return false;\n  \n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n  \n  // Most likely a plain Object\n  return true;\n};\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object'\n    && !Array.isArray(val);\n};\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n/**\n * @param {Externals} options.externals\n * @param {Request} [options.request]\n * @param {Response} [options.response]\n * @param {string} [options.responseText]\n * @property {Externals} _externals\n * @property {Request} _request\n * @property {Response} _response\n * @property {string} _text\n * @property {object} _json\n * @property {ApiResponse[]} _multipart\n */\nfunction ApiResponse(options) {\n\n    /** @private */\n    this._externals = options.externals;\n\n    /** @private */\n    this._request = options.request;\n\n    /** @private */\n    this._response = options.response;\n\n    /** @private */\n    this._text = options.responseText || '';\n\n    /** @private */\n    this._json = null;\n\n    /** @private */\n    this._multipart = [];\n\n}\n\nApiResponse._contentType = 'Content-Type';\nApiResponse._jsonContentType = 'application/json';\nApiResponse._multipartContentType = 'multipart/mixed';\nApiResponse._urlencodedContentType = 'application/x-www-form-urlencoded';\nApiResponse._headerSeparator = ':';\nApiResponse._bodySeparator = '\\n\\n';\nApiResponse._boundarySeparator = '--';\nApiResponse._unauthorizedStatus = 401;\n\n/**\n * @param {Response} response\n * @return {Promise<ApiResponse>}\n */\nApiResponse.prototype.receiveResponse = function(response) {\n\n    this._response = response;\n\n    return (new this._externals.Promise(function(resolve) {\n\n        // Ignore if not textual type\n        if (!this._isMultipart() && !this._isJson()) return resolve('');\n\n        return resolve(this.response().text());\n\n    }.bind(this))).then(function(text) {\n\n        this._text = text;\n        return text;\n\n    }.bind(this));\n\n};\n\n/**\n * @return {Response}\n */\nApiResponse.prototype.response = function() {\n    return this._response;\n};\n\n/**\n * @return {Request}\n */\nApiResponse.prototype.request = function() {\n    return this._request;\n};\n\n/**\n * @return {boolean}\n */\nApiResponse.prototype.ok = function() {\n    return this._response && this._response.ok;\n};\n\n/**\n * @return {string}\n */\nApiResponse.prototype.text = function() {\n    // Since we read text only in case JSON or Multipart\n    if (!this._isJson() && !this._isMultipart()) throw new Error('Response is not text');\n    return this._text;\n};\n\n/**\n * @return {object}\n */\nApiResponse.prototype.json = function() {\n    if (!this._isJson()) throw new Error('Response is not JSON');\n    if (!this._json) {\n        this._json = this._text ? JSON.parse(this._text) : null;\n    }\n    return this._json;\n};\n\n/**\n * @param [skipOKCheck]\n * @return {string}\n */\nApiResponse.prototype.error = function(skipOKCheck) {\n\n    if (this.ok() && !skipOKCheck) return null;\n\n    var message = (this._response && this._response.status ? this._response.status + ' ' : '') +\n                  (this._response && this._response.statusText ? this._response.statusText : '');\n\n    try {\n\n        if (this.json().message) message = this.json().message;\n        if (this.json().error_description) message = this.json().error_description;\n        if (this.json().description) message = this.json().description;\n\n    } catch (e) {}\n\n    return message;\n\n};\n\n/**\n * If it is not known upfront what would be the response, client code can treat any response as multipart\n * @return {ApiResponse[]}\n */\nApiResponse.prototype.toMultipart = function() {\n    if (!this._isMultipart()) return [this];\n    return this.multipart();\n};\n\n/**\n * @return {ApiResponse[]}\n */\nApiResponse.prototype.multipart = function() {\n\n    if (!this._isMultipart()) throw new Error('Response is not multipart');\n\n    if (!this._multipart.length) {\n\n        // Step 1. Split multipart response\n\n        var text = this.text();\n\n        if (!text) throw new Error('No response body');\n\n        var boundary = this._getContentType().match(/boundary=([^;]+)/i)[1];\n\n        if (!boundary) throw new Error('Cannot find boundary');\n\n        var parts = text.toString().split(ApiResponse._boundarySeparator + boundary);\n\n        if (parts[0].trim() === '') parts.shift();\n        if (parts[parts.length - 1].trim() == ApiResponse._boundarySeparator) parts.pop();\n\n        if (parts.length < 1) throw new Error('No parts in body');\n\n        // Step 2. Parse status info\n\n        var statusInfo = this._create(parts.shift(), this._response.status, this._response.statusText).json();\n\n        // Step 3. Parse all other parts\n\n        this._multipart = parts.map(function(part, i) {\n\n            var status = statusInfo.response[i].status;\n\n            return this._create(part, status);\n\n        }.bind(this));\n\n    }\n\n    return this._multipart;\n\n};\n\n/**\n * @private\n */\nApiResponse.prototype._isContentType = function(contentType) {\n    return this._getContentType().indexOf(contentType) > -1;\n};\n\n/**\n * @private\n */\nApiResponse.prototype._getContentType = function() {\n    return this._response.headers.get(ApiResponse._contentType) || '';\n};\n\n/**\n * @private\n */\nApiResponse.prototype._isMultipart = function() {\n    return this._isContentType(ApiResponse._multipartContentType);\n};\n\n/**\n * @private\n */\nApiResponse.prototype._isJson = function() {\n    return this._isContentType(ApiResponse._jsonContentType);\n};\n\n/**\n * Method is used to create ApiResponse object from string parts of multipart/mixed response\n * @param {string} [text]\n * @param {number} [status]\n * @param {string} [statusText]\n * @private\n * @return {ApiResponse}\n */\nApiResponse.prototype._create = function(text, status, statusText) {\n\n    text = text || '';\n    status = status || 200;\n    statusText = statusText || 'OK';\n\n    text = text.replace(/\\r/g, '');\n\n    var headers = new this._externals.Headers(),\n        headersAndBody = text.split(ApiResponse._bodySeparator),\n        headersText = (headersAndBody.length > 1) ? headersAndBody.shift() : '';\n\n    text = headersAndBody.length > 0 ? headersAndBody.join(ApiResponse._bodySeparator) : null;\n\n    (headersText || '')\n        .split('\\n')\n        .forEach(function(header) {\n\n            var split = header.trim().split(ApiResponse._headerSeparator),\n                key = split.shift().trim(),\n                value = split.join(ApiResponse._headerSeparator).trim();\n\n            if (key) headers.append(key, value);\n\n        });\n\n    var response = new this._externals.Response(text, {\n        headers: headers,\n        status: status,\n        statusText: statusText\n    });\n\n    return new ApiResponse({\n        externals: this._externals,\n        request: null,\n        response: response,\n        responseText: text\n    });\n\n};\n\nmodule.exports = ApiResponse;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n'use strict';\n\nexports.decode = exports.parse = __webpack_require__(9);\nexports.encode = exports.stringify = __webpack_require__(10);\n\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (Array.isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return Object.keys(obj).map(function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (Array.isArray(obj[k])) {\n        return obj[k].map(function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n/* WEBPACK VAR INJECTION */(function(global) {var pubnub = __webpack_require__(12);\nvar es6Promise = __webpack_require__(13);\nvar FetchPonyfill = __webpack_require__(14);\n\nvar root = (typeof window !== \"undefined\" && window) ||\n           (typeof global !== \"undefined\" && global) ||\n           (function(){ return this; })();\n\n/**\n * @constructor\n * @param {PUBNUB} [options.PUBNUB]\n * @param {function(new:Promise)} [options.Promise]\n * @param {Storage} [options.localStorage]\n * @param {fetch} [options.fetch]\n * @param {function(new:Request)} [options.Request]\n * @param {function(new:Response)} [options.Response]\n * @param {function(new:Headers)} [options.Headers]\n * @property {PUBNUB} PUBNUB\n * @property {Storage} localStorage\n * @property {function(new:Promise)} Promise\n * @property {fetch} fetch\n * @property {function(new:Request)} Request\n * @property {function(new:Response)} Response\n * @property {function(new:Headers)} Headers\n */\nfunction Externals(options) {\n\n    options = options || {};\n\n    this.PUBNUB = options.PUBNUB || root.PUBNUB || pubnub;\n    this.localStorage = options.localStorage || ((typeof root.localStorage !== 'undefined') ? root.localStorage : {});\n    this.Promise = options.Promise || root.Promise || (es6Promise && es6Promise.Promise);\n\n    var fetchPonyfill = FetchPonyfill ? FetchPonyfill({Promise: this.Promise}) : {};\n\n    this.fetch = options.fetch || root.fetch || fetchPonyfill.fetch;\n    this.Request = options.Request || root.Request || fetchPonyfill.Request;\n    this.Response = options.Response || root.Response || fetchPonyfill.Response;\n    this.Headers = options.Headers || root.Headers || fetchPonyfill.Headers;\n\n    if (!this.fetch || !this.Response || !this.Request || !this.Headers) {\n        throw new Error('Fetch API is missing');\n    }\n\n    if (!this.Promise) {\n        throw new Error('Promise is missing');\n    }\n\n    if (!this.localStorage) {\n        throw new Error('LocalStorage is missing');\n    }\n\n    if (!this.PUBNUB) {\n        throw new Error('PUBNUB is missing');\n    }\n\n}\n\nmodule.exports = Externals;\n\n/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))\n\n/***/ },\n/* 12 */\n/***/ function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_12__;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_13__;\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_14__;\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\nvar EventEmitter = __webpack_require__(6).EventEmitter;\nvar qs = __webpack_require__(8);\nvar objectAssign = __webpack_require__(1);\nvar Auth = __webpack_require__(16);\nvar Constants = __webpack_require__(17);\nvar ApiResponse = __webpack_require__(7);\n\n/**\n * @constructor\n * @param {string} options.server\n * @param {string} options.appSecret\n * @param {string} options.appKey\n * @param {string} [options.appName]\n * @param {string} [options.appVersion]\n * @param {string} [options.redirectUri]\n * @param {int} [options.refreshDelayMs]\n * @param {int} [options.refreshHandicapMs]\n * @param {boolean} [options.clearCacheOnRefreshError]\n * @param {Externals} options.externals\n * @param {Cache} options.cache\n * @param {Client} options.client\n * @property {Externals} _externals\n * @property {Cache} _cache\n * @property {Client} _client\n * @property {Promise<ApiResponse>} _refreshPromise\n * @property {Auth} _auth\n */\nfunction Platform(options) {\n\n    EventEmitter.call(this);\n\n    this.events = {\n        beforeLogin: 'beforeLogin',\n        loginSuccess: 'loginSuccess',\n        loginError: 'loginError',\n        beforeRefresh: 'beforeRefresh',\n        refreshSuccess: 'refreshSuccess',\n        refreshError: 'refreshError',\n        beforeLogout: 'beforeLogout',\n        logoutSuccess: 'logoutSuccess',\n        logoutError: 'logoutError'\n    };\n\n    options = options || {};\n\n    /** @private */\n    this._server = options.server;\n\n    /** @private */\n    this._appKey = options.appKey;\n\n    /** @private */\n    this._appSecret = options.appSecret;\n\n    /** @private */\n    this._redirectUri = options.redirectUri || '';\n\n    /** @private */\n    this._refreshDelayMs = options.refreshDelayMs || 100;\n\n    /** @private */\n    this._clearCacheOnRefreshError = typeof options.clearCacheOnRefreshError !== 'undefined'\n        ? options.clearCacheOnRefreshError\n        : true;\n\n    /** @private */\n    this._userAgent = (options.appName ?\n                      (options.appName + (options.appVersion ? '/' + options.appVersion : '')) + ' ' :\n                       '') +\n                      'RCJSSDK/' + Constants.version;\n\n    /** @private */\n    this._externals = options.externals;\n\n    /** @private */\n    this._cache = options.cache;\n\n    /** @private */\n    this._client = options.client;\n\n    /** @private */\n    this._refreshPromise = null;\n\n    /** @private */\n    this._auth = new Auth({\n        cache: this._cache,\n        cacheId: Platform._cacheId,\n        refreshHandicapMs: options.refreshHandicapMs\n    });\n\n}\n\nPlatform._urlPrefix = '/restapi';\nPlatform._apiVersion = 'v1.0';\nPlatform._tokenEndpoint = '/restapi/oauth/token';\nPlatform._revokeEndpoint = '/restapi/oauth/revoke';\nPlatform._authorizeEndpoint = '/restapi/oauth/authorize';\nPlatform._cacheId = 'platform';\n\nPlatform.prototype = Object.create(EventEmitter.prototype);\n\nPlatform.prototype.delay = function(timeout) {\n    return new this._externals.Promise(function(resolve, reject) {\n        setTimeout(function() {\n            resolve(null);\n        }, timeout);\n    });\n};\n\n/**\n * @return {Auth}\n */\nPlatform.prototype.auth = function() {\n    return this._auth;\n};\n\n/**\n * @return {Client}\n */\nPlatform.prototype.client = function() {\n    return this._client;\n};\n\n/**\n * @param {string} path\n * @param {object} [options]\n * @param {boolean} [options.addServer]\n * @param {string} [options.addMethod]\n * @param {boolean} [options.addToken]\n * @return {string}\n */\nPlatform.prototype.createUrl = function(path, options) {\n\n    path = path || '';\n    options = options || {};\n\n    var builtUrl = '',\n        hasHttp = path.indexOf('http://') != -1 || path.indexOf('https://') != -1;\n\n    if (options.addServer && !hasHttp) builtUrl += this._server;\n\n    if (path.indexOf(Platform._urlPrefix) == -1 && !hasHttp) builtUrl += Platform._urlPrefix + '/' + Platform._apiVersion;\n\n    builtUrl += path;\n\n    if (options.addMethod || options.addToken) builtUrl += (path.indexOf('?') > -1 ? '&' : '?');\n\n    if (options.addMethod) builtUrl += '_method=' + options.addMethod;\n    if (options.addToken) builtUrl += (options.addMethod ? '&' : '') + 'access_token=' + this._auth.accessToken();\n\n    return builtUrl;\n\n};\n\n/**\n * @param {string} [options.redirectUri] Overrides default RedirectURI\n * @param {string} [options.state]\n * @param {string} [options.brandId]\n * @param {string} [options.display]\n * @param {string} [options.prompt]\n * @param {boolean} [options.implicit] Use Implicit Grant flow\n * @return {string}\n */\nPlatform.prototype.loginUrl = function(options) {\n\n    options = options || {};\n\n    return this.createUrl(Platform._authorizeEndpoint + '?' + qs.stringify({\n            'response_type': options.implicit ? 'token' : 'code',\n            'redirect_uri': options.redirectUri || this._redirectUri,\n            'client_id': this._appKey,\n            'state': options.state || '',\n            'brand_id': options.brandId || '',\n            'display': options.display || '',\n            'prompt': options.prompt || ''\n        }), {addServer: true});\n\n};\n\n/**\n * @param {string} url\n * @return {Object}\n */\nPlatform.prototype.parseLoginRedirect = function(url) {\n\n    function getParts(url, separator) {\n        return url.split(separator).reverse()[0];\n    }\n\n    var response = (url.indexOf('#') === 0 && getParts(url, '#')) ||\n                   (url.indexOf('?') === 0 && getParts(url, '?')) ||\n                   null;\n\n    if (!response) throw new Error('Unable to parse response');\n\n    var queryString = qs.parse(response);\n\n    if (!queryString) throw new Error('Unable to parse response');\n\n    var error = queryString.error_description || queryString.error;\n\n    if (error) {\n        var e = new Error(error);\n        e.error = queryString.error;\n        throw e;\n    }\n\n    return queryString;\n\n};\n\n/**\n * Convenience method to handle 3-legged OAuth\n *\n * Attention! This is an experimental method and it's signature and behavior may change without notice.\n *\n * @experimental\n * @param {string} options.url\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {object} [options.login] additional options for login()\n * @param {string} [options.origin]\n * @param {string} [options.property] name of window.postMessage's event data property\n * @param {string} [options.target] target for window.open()\n * @return {Promise}\n */\nPlatform.prototype.loginWindow = function(options) {\n\n    return new this._externals.Promise(function(resolve, reject) {\n\n        if (typeof window === 'undefined') throw new Error('This method can be used only in browser');\n\n        if (!options.url) throw new Error('Missing mandatory URL parameter');\n\n        options = options || {};\n        options.url = options.url || 400;\n        options.width = options.width || 400;\n        options.height = options.height || 600;\n        options.origin = options.origin || window.location.origin;\n        options.property = options.property || Constants.authResponseProperty;\n        options.target = options.target || '_blank';\n\n        var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n        var dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n\n        var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;\n        var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;\n\n        var left = ((width / 2) - (options.width / 2)) + dualScreenLeft;\n        var top = ((height / 2) - (options.height / 2)) + dualScreenTop;\n        var win = window.open(options.url, '_blank', (options.target == '_blank') ? 'scrollbars=yes, status=yes, width=' + options.width + ', height=' + options.height + ', left=' + left + ', top=' + top : '');\n\n        if (win.focus) win.focus();\n\n        var eventMethod = window.addEventListener ? 'addEventListener' : 'attachEvent';\n        var eventRemoveMethod = eventMethod == 'addEventListener' ? 'removeEventListener' : 'detachEvent';\n        var messageEvent = eventMethod == 'addEventListener' ? 'message' : 'onmessage';\n\n        var eventListener = function(e) {\n\n            try {\n\n                if (e.origin != options.origin) return;\n                if (!e.data || !e.data[options.property]) return; // keep waiting\n\n                win.close();\n                window[eventRemoveMethod](messageEvent, eventListener);\n\n\n                var loginOptions = this.parseLoginRedirect(e.data[options.property]);\n\n                if (!loginOptions.code && !loginOptions.access_token) throw new Error('No authorization code or token');\n\n                resolve(loginOptions);\n\n            /* jshint -W002 */\n            } catch (e) {\n                reject(e);\n            }\n\n        }.bind(this);\n\n        window[eventMethod](messageEvent, eventListener, false);\n\n    }.bind(this));\n\n};\n\n/**\n * @return {Promise<boolean>}\n */\nPlatform.prototype.loggedIn = function() {\n\n    return this.ensureLoggedIn().then(function() {\n        return true;\n    }).catch(function() {\n        return false;\n    });\n\n};\n\n/**\n * @param {string} options.username\n * @param {string} options.password\n * @param {string} [options.extension]\n * @param {string} [options.code]\n * @param {string} [options.redirectUri]\n * @param {string} [options.endpointId]\n * @param {string} [options.accessTokenTtl]\n * @param {string} [options.refreshTokenTtl]\n * @param {string} [options.access_token]\n * @returns {Promise<ApiResponse>}\n */\nPlatform.prototype.login = function(options) {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        options = options || {};\n\n        this.emit(this.events.beforeLogin);\n\n        var body = {};\n\n        if (options.access_token) {\n\n            //TODO Potentially make a request to /oauth/tokeninfo\n            return resolve(options);\n\n        }\n\n        if (!options.code) {\n\n            body.grant_type = 'password';\n            body.username = options.username;\n            body.password = options.password;\n            body.extension = options.extension || '';\n\n        } else if (options.code) {\n\n            body.grant_type = 'authorization_code';\n            body.code = options.code;\n            body.redirect_uri = options.redirectUri || this._redirectUri;\n            //body.client_id = this.getCredentials().key; // not needed\n\n        }\n\n        if (options.endpointId) body.endpoint_id = options.endpointId;\n        if (options.accessTokenTtl) body.accessTokenTtl = options.accessTokenTtl;\n        if (options.refreshTokenTtl) body.refreshTokenTtl = options.refreshTokenTtl;\n\n        resolve(this._tokenRequest(Platform._tokenEndpoint, body));\n\n    }.bind(this))).then(function(res) {\n\n        var apiResponse = res.json ? res : null;\n        var json = apiResponse && apiResponse.json() || res;\n\n        this._auth.setData(json);\n\n        this.emit(this.events.loginSuccess, apiResponse);\n\n        return apiResponse;\n\n    }.bind(this)).catch(function(e) {\n\n        if (this._clearCacheOnRefreshError) {\n            this._cache.clean();\n        }\n\n        this.emit(this.events.loginError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n * @private\n */\nPlatform.prototype._refresh = function() {\n\n    return this.delay(this._refreshDelayMs).then(function() {\n\n        this.emit(this.events.beforeRefresh);\n\n        // Perform sanity checks\n        if (!this._auth.refreshToken()) throw new Error('Refresh token is missing');\n        if (!this._auth.refreshTokenValid()) throw new Error('Refresh token has expired');\n\n        return this._tokenRequest(Platform._tokenEndpoint, {\n            \"grant_type\": \"refresh_token\",\n            \"refresh_token\": this._auth.refreshToken(),\n            \"access_token_ttl\": this._auth.data().expires_in + 1,\n            \"refresh_token_ttl\": this._auth.data().refresh_token_expires_in + 1\n        });\n\n    }.bind(this)).then(function(/** @type {ApiResponse} */ res) {\n\n        var json = res.json();\n\n        if (!json.access_token) {\n            throw this._client.makeError(new Error('Malformed OAuth response'), res);\n        }\n\n        this._auth.setData(json);\n\n        this.emit(this.events.refreshSuccess, res);\n\n        return res;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._client.makeError(e);\n\n        if (this._clearCacheOnRefreshError) {\n            this._cache.clean();\n        }\n\n        this.emit(this.events.refreshError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nPlatform.prototype.refresh = function() {\n\n    if (this._refreshPromise) {\n        return this._refreshPromise;\n    }\n\n    this._refreshPromise = this._refresh()\n        .then(function(res) {\n            this._refreshPromise = null;\n            return res;\n        }.bind(this))\n        .catch(function(e) {\n            this._refreshPromise = null;\n            throw e;\n        }.bind(this));\n\n    return this._refreshPromise;\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nPlatform.prototype.logout = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        this.emit(this.events.beforeLogout);\n\n        resolve(this._tokenRequest(Platform._revokeEndpoint, {\n            token: this._auth.accessToken()\n        }));\n\n    }.bind(this))).then(function(res) {\n\n        this._cache.clean();\n\n        this.emit(this.events.logoutSuccess, res);\n\n        return res;\n\n    }.bind(this)).catch(function(e) {\n\n        this.emit(this.events.logoutError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @param {Request} request\n * @param {object} [options]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<Request>}\n */\nPlatform.prototype.inflateRequest = function(request, options) {\n\n    options = options || {};\n\n    if (options.skipAuthCheck) return this._externals.Promise.resolve(request);\n\n    return this.ensureLoggedIn().then(function() {\n\n        request.headers.set('X-User-Agent', this._userAgent);\n        request.headers.set('Client-Id', this._appKey);\n        request.headers.set('Authorization', this._authHeader());\n        //request.url = this.createUrl(request.url, {addServer: true}); //FIXME Spec prevents this...\n\n        return request;\n\n    }.bind(this));\n\n};\n\n/**\n * @param {Request} request\n * @param {object} [options]\n * @param {boolean} [options.skipAuthCheck]\n * @param {boolean} [options.retry] Will be set by this method if SDK makes second request\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.sendRequest = function(request, options) {\n\n    return this.inflateRequest(request, options).then(function(request) {\n\n        options = options || {};\n\n        return this._client.sendRequest(request);\n\n    }.bind(this)).catch(function(e) {\n\n        // Guard is for errors that come from polling\n        if (!e.apiResponse || !e.apiResponse.response() ||\n            (e.apiResponse.response().status != ApiResponse._unauthorizedStatus) ||\n            options.retry) throw e;\n\n        this._auth.cancelAccessToken();\n\n        options.retry = true;\n\n        return this.sendRequest(request, options);\n\n    }.bind(this));\n\n};\n\n/**\n * General purpose function to send anything to server\n * @param {string} options.url\n * @param {object} [options.body]\n * @param {string} [options.method]\n * @param {object} [options.query]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.send = function(options) {\n\n    options = options || {};\n\n    //FIXME https://github.com/bitinn/node-fetch/issues/43\n    options.url = this.createUrl(options.url, {addServer: true});\n\n    return this.sendRequest(this._client.createRequest(options), options);\n\n};\n\n/**\n * @param {string} url\n * @param {object} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.get = function(url, query, options) {\n    return this.send(objectAssign({}, {method: 'GET', url: url, query: query}, options));\n};\n\n/**\n * @param {string} url\n * @param {object} body\n * @param {object} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.post = function(url, body, query, options) {\n    return this.send(objectAssign({}, {method: 'POST', url: url, query: query, body: body}, options));\n};\n\n/**\n * @param {string} url\n * @param {object} [body]\n * @param {object} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.put = function(url, body, query, options) {\n    return this.send(objectAssign({}, {method: 'PUT', url: url, query: query, body: body}, options));\n};\n\n/**\n * @param {string} url\n * @param {string} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype['delete'] = function(url, query, options) {\n    return this.send(objectAssign({}, {method: 'DELETE', url: url, query: query}, options));\n};\n\nPlatform.prototype.ensureLoggedIn = function() {\n    if (this._isAccessTokenValid()) return this._externals.Promise.resolve();\n    return this.refresh();\n};\n\n/**\n * @param path\n * @param body\n * @return {Promise.<ApiResponse>}\n * @private\n */\nPlatform.prototype._tokenRequest = function(path, body) {\n\n    return this.send({\n        url: path,\n        skipAuthCheck: true,\n        body: body,\n        method: 'POST',\n        headers: {\n            'Authorization': 'Basic ' + this._apiKey(),\n            'Content-Type': ApiResponse._urlencodedContentType\n        }\n    });\n\n};\n\n/**\n * @return {boolean}\n * @private\n */\nPlatform.prototype._isAccessTokenValid = function() {\n    return this._auth.accessTokenValid();\n};\n\n/**\n * @return {string}\n * @private\n */\nPlatform.prototype._apiKey = function() {\n    var apiKey = this._appKey + ':' + this._appSecret;\n    return (typeof btoa == 'function') ? btoa(apiKey) : new Buffer(apiKey).toString('base64');\n};\n\n/**\n * @return {string}\n * @private\n */\nPlatform.prototype._authHeader = function() {\n    var token = this._auth.accessToken();\n    return this._auth.tokenType() + (token ? ' ' + token : '');\n};\n\nmodule.exports = Platform;\n\n/***/ },\n/* 16 */\n/***/ function(module, exports) {\n\n/**\n * @param {Cache} options.cache\n * @param {string} options.cacheId\n * @param {int} [options.refreshHandicapMs]\n * @constructor\n * @property {Cache} _cache\n * @property {int} _refreshHandicapMs\n * @property {string} _cacheId\n */\nfunction Auth(options) {\n\n    /** @private */\n    this._cache = options.cache;\n\n    /** @private */\n    this._cacheId = options.cacheId;\n\n    /** @private */\n    this._refreshHandicapMs = options.refreshHandicapMs || 60 * 1000; // 1 minute\n\n}\n\nAuth.prototype.accessToken = function() {\n    return this.data().access_token;\n};\n\nAuth.prototype.refreshToken = function() {\n    return this.data().refresh_token;\n};\n\nAuth.prototype.tokenType = function() {\n    return this.data().token_type;\n};\n\n/**\n * @return {{token_type: string, access_token: string, expires_in: number, refresh_token: string, refresh_token_expires_in: number}}\n */\nAuth.prototype.data = function() {\n\n    return this._cache.getItem(this._cacheId) || {\n            token_type: '',\n            access_token: '',\n            expires_in: 0,\n            refresh_token: '',\n            refresh_token_expires_in: 0\n        };\n\n};\n\n/**\n * @param {object} newData\n * @return {Auth}\n */\nAuth.prototype.setData = function(newData) {\n\n    newData = newData || {};\n\n    var data = this.data();\n\n    Object.keys(newData).forEach(function(key) {\n        data[key] = newData[key];\n    });\n\n    data.expire_time = Date.now() + (data.expires_in * 1000);\n    data.refresh_token_expire_time = Date.now() + (data.refresh_token_expires_in * 1000);\n\n    this._cache.setItem(this._cacheId, data);\n\n    return this;\n\n};\n\n/**\n * Check if there is a valid (not expired) access token\n * @return {boolean}\n */\nAuth.prototype.accessTokenValid = function() {\n\n    var authData = this.data();\n    return (authData.expire_time - this._refreshHandicapMs > Date.now());\n\n};\n\n/**\n * Check if there is a valid (not expired) access token\n * @return {boolean}\n */\nAuth.prototype.refreshTokenValid = function() {\n\n    return (this.data().refresh_token_expire_time > Date.now());\n\n};\n\n/**\n * @return {Auth}\n */\nAuth.prototype.cancelAccessToken = function() {\n\n    return this.setData({\n        access_token: '',\n        expires_in: 0\n    });\n\n};\n\nmodule.exports = Auth;\n\n//export interface IAuthData {\n//    remember?:boolean;\n//    token_type?:string;\n//    access_token?:string;\n//    expires_in?:number; // actually it's string\n//    expire_time?:number;\n//    refresh_token?:string;\n//    refresh_token_expires_in?:number; // actually it's string\n//    refresh_token_expire_time?:number;\n//    scope?:string;\n//}\n\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\nmodule.exports = {\n    version: __webpack_require__(18).version,\n    authResponseProperty: 'RCAuthorizationResponse'\n};\n\n/***/ },\n/* 18 */\n/***/ function(module, exports) {\n\nmodule.exports = {\n\t\"name\": \"ringcentral\",\n\t\"version\": \"3.0.0-rc2\",\n\t\"scripts\": {\n\t\t\"clean\": \"rm -rf build/*\",\n\t\t\"build\": \"npm run clean && ./node_modules/.bin/webpack --display-modules --progress --colors --bail\",\n\t\t\"watch\": \"npm run build -- --watch\",\n\t\t\"test\": \"npm run hint && npm run build && npm run istanbul && npm run karma && npm run karma-webpack\",\n\t\t\"mocha\": \"mocha --require ./src/test/test.js ./src/**/*-spec.js\",\n\t\t\"mocha-watch\": \"npm run mocha -- --watch\",\n\t\t\"mocha-api\": \"mocha ./test-api/**/*-spec.js\",\n\t\t\"karma\": \"karma start karma.conf.js\",\n\t\t\"karma-watch\": \"npm run karma -- --no-single-run --auto-watch\",\n\t\t\"karma-webpack\": \"karma start karma.conf.webpack.js\",\n\t\t\"karma-webpack-watch\": \"npm run karma-webpack -- --no-single-run --auto-watch\",\n\t\t\"istanbul\": \"istanbul cover --dir=./build/coverage --report=lcov _mocha -- --require ./src/test/test.js --reporter spec ./src/**/*-spec.js\",\n\t\t\"tsd\": \"tsd reinstall -so\",\n\t\t\"start\": \"http-server -p 3030\",\n\t\t\"docs\": \"jsdoc2md 'src/**/*!(test).js' > API.md\",\n\t\t\"hint\": \"jshint src/**/*.js\"\n\t},\n\t\"dependencies\": {\n\t\t\"es6-promise\": \"^3.0.2\",\n\t\t\"fetch-ponyfill\": \"^3.0.0\",\n\t\t\"is-plain-object\": \"^2.0.1\",\n\t\t\"object-assign\": \"^4.1.0\",\n\t\t\"pubnub\": \"^3.16.3\"\n\t},\n\t\"devDependencies\": {\n\t\t\"chai\": \"^3.5.0\",\n\t\t\"fetch-mock\": \"^5.5.0\",\n\t\t\"http-server\": \"^0.9.0\",\n\t\t\"istanbul\": \"^0.4.1\",\n\t\t\"jsdoc-to-markdown\": \"^2.0.1\",\n\t\t\"jshint\": \"^2.9.4\",\n\t\t\"json-loader\": \"^0.5.4\",\n\t\t\"karma\": \"^0.13.22\",\n\t\t\"karma-chai-plugins\": \"^0.7.0\",\n\t\t\"karma-chrome-launcher\": \"^0.2.3\",\n\t\t\"karma-coverage\": \"^0.5.3\",\n\t\t\"karma-firefox-launcher\": \"^0.1.7\",\n\t\t\"karma-html-reporter\": \"^0.2.6\",\n\t\t\"karma-mocha\": \"^0.2.0\",\n\t\t\"karma-mocha-reporter\": \"^2.0.0\",\n\t\t\"karma-phantomjs-launcher\": \"^1.0.0\",\n\t\t\"karma-sourcemap-loader\": \"^0.3.5\",\n\t\t\"karma-webpack\": \"^1.7.0\",\n\t\t\"mocha\": \"^2.4.5\",\n\t\t\"phantomjs-prebuilt\": \"^2.1.7\",\n\t\t\"sinon\": \"^1.17.3\",\n\t\t\"sinon-chai\": \"^2.8.0\",\n\t\t\"soap\": \"^0.13.0\",\n\t\t\"virtual-module-webpack-plugin\": \"^0.1.1\",\n\t\t\"webpack\": \"^1.12.14\",\n\t\t\"whatwg-fetch\": \"^1.0.0\"\n\t},\n\t\"jsdoc2md\": {\n\t\t\"separators\": true,\n\t\t\"module-index-format\": \"grouped\",\n\t\t\"param-list-format\": \"table\",\n\t\t\"property-list-format\": \"table\"\n\t},\n\t\"jshintConfig\": {\n\t\t\"curly\": false,\n\t\t\"eqeqeq\": false,\n\t\t\"expr\": true,\n\t\t\"indent\": 4,\n\t\t\"latedef\": true,\n\t\t\"laxbreak\": true,\n\t\t\"plusplus\": false,\n\t\t\"shadow\": true,\n\t\t\"sub\": true\n\t},\n\t\"preferGlobal\": false,\n\t\"private\": false,\n\t\"main\": \"./src/SDK.js\",\n\t\"author\": {\n\t\t\"name\": \"RingCentral, Inc.\",\n\t\t\"email\": \"devsupport@ringcentral.com\"\n\t},\n\t\"contributors\": [\n\t\t{\n\t\t\t\"name\": \"Kirill Konshin\"\n\t\t}\n\t],\n\t\"repository\": {\n\t\t\"type\": \"git\",\n\t\t\"url\": \"git://github.com/ringcentral/ringcentral-js.git\"\n\t},\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/ringcentral/ringcentral-js/issues\"\n\t},\n\t\"homepage\": \"https://github.com/ringcentral/ringcentral-js\",\n\t\"engines\": {\n\t\t\"node\": \">=0.10.36\"\n\t},\n\t\"license\": \"MIT\"\n};\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\nvar EventEmitter = __webpack_require__(6).EventEmitter;\n\n/**\n * @param {Platform} options.platform\n * @param {Externals} options.externals\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @property {Externals} _externals\n * @property {Platform} _platform\n * @property {int} _pollInterval\n * @property {int} _renewHandicapMs\n * @property {PUBNUB} _pubnub\n * @property {string} _pubnubLastChannel\n * @property {int} _timeout\n * @property {ISubscription} _subscription\n * @constructor\n */\nfunction Subscription(options) {\n\n    EventEmitter.call(this);\n\n    options = options || {};\n\n    this.events = {\n        notification: 'notification',\n        removeSuccess: 'removeSuccess',\n        removeError: 'removeError',\n        renewSuccess: 'renewSuccess',\n        renewError: 'renewError',\n        subscribeSuccess: 'subscribeSuccess',\n        subscribeError: 'subscribeError'\n    };\n\n    /** @private */\n    this._externals = options.externals;\n\n    /** @private */\n    this._platform = options.platform;\n\n    /** @private */\n    this._pollInterval = options.pollInterval || 10 * 1000;\n\n    /** @private */\n    this._renewHandicapMs = options.renewHandicapMs || 2 * 60 * 1000;\n\n    /** @private */\n    this._pubnub = null;\n\n    /** @private */\n    this._pubnubLastChannel = null;\n\n    /** @private */\n    this._timeout = null;\n\n    /** @private */\n    this._subscription = null;\n\n}\n\nSubscription.prototype = Object.create(EventEmitter.prototype);\n\nSubscription.prototype.subscribed = function() {\n\n    var subscription = this.subscription();\n\n    return !!(subscription.id &&\n              subscription.deliveryMode &&\n              subscription.deliveryMode.subscriberKey &&\n              subscription.deliveryMode.address);\n\n};\n\n/**\n * @return {boolean}\n */\nSubscription.prototype.alive = function() {\n    return this.subscribed() && Date.now() < this.expirationTime();\n};\n\n/**\n * @return {boolean}\n */\nSubscription.prototype.expired = function() {\n    if (!this.subscribed()) return true;\n    return !this.subscribed() || Date.now() > this.subscription().expirationTime;\n};\n\nSubscription.prototype.expirationTime = function() {\n    return new Date(this.subscription().expirationTime || 0).getTime() - this._renewHandicapMs;\n};\n\n/**\n * @param {ISubscription} subscription\n * @return {Subscription}\n */\nSubscription.prototype.setSubscription = function(subscription) {\n\n    subscription = subscription || {};\n\n    this._clearTimeout();\n    this._setSubscription(subscription);\n    this._subscribeAtPubnub();\n    this._setTimeout();\n\n    return this;\n\n};\n\n/**\n * @return {ISubscription}\n */\nSubscription.prototype.subscription = function() {\n    return this._subscription || {};\n};\n\n/**\n * Creates or updates subscription if there is an active one\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.register = function() {\n\n    if (this.alive()) {\n        return this.renew();\n    } else {\n        return this.subscribe();\n    }\n\n};\n\n/**\n * @return {string[]}\n */\nSubscription.prototype.eventFilters = function() {\n    return this.subscription().eventFilters || [];\n};\n\n/**\n * @param {string[]} events\n * @return {Subscription}\n */\nSubscription.prototype.addEventFilters = function(events) {\n    this.setEventFilters(this.eventFilters().concat(events));\n    return this;\n};\n\n/**\n * @param {string[]} events\n * @return {Subscription}\n */\nSubscription.prototype.setEventFilters = function(events) {\n    var subscription = this.subscription();\n    subscription.eventFilters = events;\n    this._setSubscription(subscription);\n    return this;\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.subscribe = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        this._clearTimeout();\n\n        if (!this.eventFilters().length) throw new Error('Events are undefined');\n\n        resolve(this._platform.post('/subscription', {\n            eventFilters: this._getFullEventFilters(),\n            deliveryMode: {\n                transportType: 'PubNub'\n            }\n        }));\n\n    }.bind(this))).then(function(response) {\n\n        var json = response.json();\n\n        this.setSubscription(json)\n            .emit(this.events.subscribeSuccess, response);\n\n        return response;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._platform.client().makeError(e);\n\n        this.reset()\n            .emit(this.events.subscribeError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.renew = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        this._clearTimeout();\n\n        if (!this.subscribed()) throw new Error('No subscription');\n\n        if (!this.eventFilters().length) throw new Error('Events are undefined');\n\n        resolve(this._platform.put('/subscription/' + this.subscription().id, {\n            eventFilters: this._getFullEventFilters()\n        }));\n\n    }.bind(this))).then(function(response) {\n\n        var json = response.json();\n\n        this.setSubscription(json)\n            .emit(this.events.renewSuccess, response);\n\n        return response;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._platform.client().makeError(e);\n\n        this.reset()\n            .emit(this.events.renewError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.remove = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        if (!this.subscribed()) throw new Error('No subscription');\n\n        resolve(this._platform.delete('/subscription/' + this.subscription().id));\n\n    })).then(function(response) {\n\n        this.reset()\n            .emit(this.events.removeSuccess, response);\n\n        return response;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._platform.client().makeError(e);\n\n        this.emit(this.events.removeError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.resubscribe = function() {\n    var filters = this.eventFilters();\n    return this.reset().setEventFilters(filters).subscribe();\n};\n\n/**\n * Remove subscription and disconnect from PUBNUB\n * This method resets subscription at client side but backend is not notified\n * @return {Subscription}\n */\nSubscription.prototype.reset = function() {\n    this._clearTimeout();\n    if (this.subscribed() && this._pubnub) this._pubnub.unsubscribe({channel: this.subscription().deliveryMode.address});\n    this._setSubscription(null);\n    return this;\n};\n\n/**\n * @param subscription\n * @private\n */\nSubscription.prototype._setSubscription = function(subscription) {\n    this._subscription = subscription;\n};\n\n/**\n * @return {string[]}\n * @private\n */\nSubscription.prototype._getFullEventFilters = function() {\n\n    return this.eventFilters().map(function(event) {\n        return this._platform.createUrl(event);\n    }.bind(this));\n\n};\n\n/**\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._setTimeout = function() {\n\n    this._clearTimeout();\n\n    if (!this.alive()) throw new Error('Subscription is not alive');\n\n    this._timeout = setInterval(function() {\n\n        if (this.alive()) return;\n\n        if (this.expired()) {\n            this.subscribe();\n        } else {\n            this.renew();\n        }\n\n    }.bind(this), this._pollInterval);\n\n    return this;\n\n};\n\n/**\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._clearTimeout = function() {\n    clearInterval(this._timeout);\n    return this;\n};\n\nSubscription.prototype._decrypt = function(message) {\n\n    if (!this.subscribed()) throw new Error('No subscription');\n\n    if (this.subscription().deliveryMode.encryptionKey) {\n\n        message = this._externals.PUBNUB.crypto_obj.decrypt(message, this.subscription().deliveryMode.encryptionKey, {\n            encryptKey: false,\n            keyEncoding: 'base64',\n            keyLength: 128,\n            mode: 'ecb'\n        });\n\n    }\n\n    return message;\n\n};\n\n/**\n * @param message\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._notify = function(message) {\n    this.emit(this.events.notification, this._decrypt(message));\n    return this;\n};\n\n/**\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._subscribeAtPubnub = function() {\n\n    if (!this.alive()) throw new Error('Subscription is not alive');\n\n    var deliveryMode = this.subscription().deliveryMode;\n\n    if (this._pubnub) {\n\n        if (this._pubnubLastChannel == deliveryMode.address) { // Nothing to update, keep listening to same channel\n            return this;\n        } else if (this._pubnubLastChannel) { // Need to subscribe to new channel\n            this._pubnub.unsubscribe({channel: this._pubnubLastChannel});\n        }\n\n        // Re-init for new data\n        this._pubnub = this._pubnub.init({\n            ssl: true,\n            subscribe_key: deliveryMode.subscriberKey\n        });\n\n    } else {\n\n        // Init from scratch\n        this._pubnub = this._externals.PUBNUB.init({\n            ssl: true,\n            subscribe_key: deliveryMode.subscriberKey\n        });\n\n        this._pubnub.ready(); //TODO This may be not needed anymore\n\n    }\n\n    this._pubnubLastChannel = deliveryMode.address;\n\n    this._pubnub.subscribe({\n        channel: deliveryMode.address,\n        message: this._notify.bind(this),\n        connect: function() {}\n    });\n\n    return this;\n\n};\n\nmodule.exports = Subscription;\n\n/**\n * The complete Triforce, or one or more components of the Triforce.\n * @typedef {Object} ISubscription\n * @property {string} [id]\n * @property {string} [uri]\n * @property {string[]} [eventFilters]\n * @property {string} [expirationTime] Format: 2014-03-12T19:54:35.613Z\n * @property {int} [expiresIn]\n * @property {string} [deliveryMode.transportType]\n * @property {boolean} [deliveryMode.encryption]\n * @property {string} [deliveryMode.address]\n * @property {string} [deliveryMode.subscriberKey]\n * @property {string} [deliveryMode.encryptionKey]\n * @property {string} [deliveryMode.secretKey]\n * @property {string} [creationTime]\n * @property {string} [status] Active\n */\n\n/***/ },\n/* 20 */\n/***/ function(module, exports, __webpack_require__) {\n\nvar Subscription = __webpack_require__(19);\n\n/**\n * @param {Platform} options.platform\n * @param {Externals} options.externals\n * @param {Cache} options.cache\n * @param {string} options.cacheKey\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @return {CachedSubscription}\n * @constructor\n * @property {Cache} _cache\n * @extends Subscription\n */\nfunction CachedSubscription(options) {\n\n    options = options || {};\n\n    if (!options.cacheKey) throw new Error('Cached Subscription requires cacheKey parameter to be defined');\n\n    /** @private */\n    this._cacheKey = options.cacheKey;\n\n    Subscription.call(this, options);\n\n    /** @private */\n    this._cache = options.cache;\n\n    // This is not used in this class\n    this._subscription = undefined;\n\n}\n\nCachedSubscription.prototype = Object.create(Subscription.prototype);\n\nCachedSubscription.prototype.subscription = function() {\n    return this._cache.getItem(this._cacheKey) || {};\n};\n\nCachedSubscription.prototype._setSubscription = function(subscription) {\n    return this._cache.setItem(this._cacheKey, subscription);\n};\n\n/**\n * This function checks whether there are any pre-defined eventFilters in cache and if not -- uses provided as defaults\n * @param {string[]} events\n * @return {CachedSubscription}\n */\nCachedSubscription.prototype.restore = function(events) {\n\n    if (!this.eventFilters().length) {\n        this.setEventFilters(events);\n    }\n\n    return this;\n\n};\n\nmodule.exports = CachedSubscription;\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** ringcentral.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/build/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 14d7676e1e9def719785\n **/","/**\n * @namespace RingCentral\n */\nvar objectAssign = require('object-assign');\nvar Cache = require(\"./core/Cache\");\nvar Client = require(\"./http/Client\");\nvar Externals = require(\"./core/Externals\");\nvar Platform = require(\"./platform/Platform\");\nvar Subscription = require(\"./subscription/Subscription\");\nvar CachedSubscription = require(\"./subscription/CachedSubscription\");\nvar Constants = require(\"./core/Constants\");\n\n/**\n * @constructor\n * @param {string} options.server\n * @param {string} options.appSecret\n * @param {string} options.appKey\n * @param {string} [options.cachePrefix]\n * @param {string} [options.appName]\n * @param {string} [options.appVersion]\n * @param {string} [options.redirectUri]\n * @param {PUBNUB} [options.PUBNUB]\n * @param {function(new:Promise)} [options.Promise]\n * @param {Storage} [options.localStorage]\n * @param {fetch} [options.fetch]\n * @param {function(new:Request)} [options.Request]\n * @param {function(new:Response)} [options.Response]\n * @param {function(new:Headers)} [options.Headers]\n * @param {int} [options.refreshDelayMs]\n * @param {int} [options.refreshHandicapMs]\n * @param {boolean} [options.clearCacheOnRefreshError]\n * @property {Externals} _externals\n * @property {Cache} _cache\n * @property {Client} _client\n * @property {Platform} _platform\n */\nfunction SDK(options) {\n\n    /** @private */\n    this._externals = new Externals(options);\n\n    /** @private */\n    this._cache = new Cache({\n        externals: this._externals,\n        cachePrefix: options.cachePrefix\n    });\n\n    /** @private */\n    this._client = new Client(this._externals);\n\n    /** @private */\n    this._platform = new Platform(objectAssign({}, options, {\n        externals: this._externals,\n        client: this._client,\n        cache: this._cache\n    }));\n\n}\n\nSDK.version = Constants.version;\n\nSDK.server = {\n    sandbox: 'https://platform.devtest.ringcentral.com',\n    production: 'https://platform.ringcentral.com'\n};\n\n/**\n * @return {Platform}\n */\nSDK.prototype.platform = function() {\n    return this._platform;\n};\n\n/**\n * @return {Cache}\n */\nSDK.prototype.cache = function() {\n    return this._cache;\n};\n\n/**\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @return {Subscription}\n */\nSDK.prototype.createSubscription = function(options) {\n    return new Subscription(objectAssign({}, options, {\n        externals: this._externals,\n        platform: this._platform\n    }));\n};\n\n/**\n * @param {string} options.cacheKey\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @return {CachedSubscription}\n */\nSDK.prototype.createCachedSubscription = function(options) {\n\n    if (typeof arguments[0] == 'string') {\n        options = {cacheKey: arguments[0].toString()};\n    } else {\n        options = options || {};\n    }\n\n    return new CachedSubscription(objectAssign({}, options, {\n        externals: this._externals,\n        platform: this._platform,\n        cache: this._cache\n    }));\n\n};\n\nSDK.handleLoginRedirect = function(origin) {\n\n    var response = window.location.hash ? window.location.hash : window.location.search;\n    var msg = {};\n    msg[Constants.authResponseProperty] = response;\n    window.opener.postMessage(msg, origin || window.location.origin);\n\n};\n\nmodule.exports = SDK;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/SDK.js\n ** module id = 0\n ** module chunks = 0 1\n **/","'use strict';\n/* eslint-disable no-unused-vars */\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (e) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (Object.getOwnPropertySymbols) {\n\t\t\tsymbols = Object.getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/object-assign/index.js\n ** module id = 1\n ** module chunks = 0 1\n **/","/**\n * @param {Externals} options.externals\n * @param {string} [options.prefix]\n * @property {Externals} _externals\n */\nfunction Cache(options) {\n\n    /** @private */\n    this._prefix = options.prefix || Cache.defaultPrefix;\n\n    /** @private */\n    this._externals = options.externals;\n\n}\n\nCache.defaultPrefix = 'rc-';\n\nCache.prototype.setItem = function(key, data) {\n    this._externals.localStorage[this._prefixKey(key)] = JSON.stringify(data);\n    return this;\n};\n\nCache.prototype.removeItem = function(key) {\n    delete this._externals.localStorage[this._prefixKey(key)];\n    return this;\n};\n\nCache.prototype.getItem = function(key) {\n    var item = this._externals.localStorage[this._prefixKey(key)];\n    if (!item) return null;\n    return JSON.parse(item);\n};\n\nCache.prototype.clean = function() {\n\n    for (var key in this._externals.localStorage) {\n\n        if (!this._externals.localStorage.hasOwnProperty(key)) continue;\n\n        if (key.indexOf(this._prefix) === 0) {\n            delete this._externals.localStorage[key];\n        }\n\n    }\n\n    return this;\n\n};\n\nCache.prototype._prefixKey = function(key) {\n    return this._prefix + key;\n};\n\nmodule.exports = Cache;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/core/Cache.js\n ** module id = 2\n ** module chunks = 0 1\n **/","var isPlainObject = require(\"is-plain-object\");\nvar EventEmitter = require(\"events\").EventEmitter;\nvar ApiResponse = require(\"./ApiResponse\");\nvar qs = require(\"querystring\");\n\nfunction findHeaderName(name, headers) {\n    name = name.toLowerCase();\n    return Object.keys(headers).reduce(function(res, key) {\n        if (res) return res;\n        if (name == key.toLowerCase()) return key;\n        return res;\n    }, null);\n}\n\n/**\n * @param {Externals} externals\n * @property {Externals} _externals\n */\nfunction Client(externals) {\n\n    EventEmitter.call(this);\n\n    /** @private */\n    this._externals = externals;\n\n    this.events = {\n        beforeRequest: 'beforeRequest',\n        requestSuccess: 'requestSuccess',\n        requestError: 'requestError'\n    };\n\n}\n\nClient._allowedMethods = ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS', 'HEAD'];\n\nClient.prototype = Object.create(EventEmitter.prototype);\n\n/**\n * @param {Request} request\n * @return {Promise<ApiResponse>}\n */\nClient.prototype.sendRequest = function(request) {\n\n    var apiResponse = new ApiResponse({\n        externals: this._externals,\n        request: request\n    });\n\n    return (new this._externals.Promise(function(resolve) {\n\n        //TODO Stop request if listeners return false\n        this.emit(this.events.beforeRequest, apiResponse);\n\n        resolve(this._loadResponse(request));\n\n    }.bind(this))).then(function(response) {\n\n        return apiResponse.receiveResponse(response);\n\n    }).then(function() {\n\n        if (!apiResponse.ok()) throw new Error('Response has unsuccessful status');\n\n        this.emit(this.events.requestSuccess, apiResponse);\n\n        return apiResponse;\n\n    }.bind(this)).catch(function(e) {\n\n        if (!e.apiResponse) e = this.makeError(e, apiResponse);\n\n        this.emit(this.events.requestError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @param {Request} request\n * @return {Promise<Response>}\n * @private\n */\nClient.prototype._loadResponse = function(request) {\n    return this._externals.fetch.call(null, request.url, request);\n};\n\n/**\n * Wraps the JS Error object with transaction information\n * @param {Error|IApiError} e\n * @param {ApiResponse} apiResponse\n * @return {IApiError}\n */\nClient.prototype.makeError = function(e, apiResponse) {\n\n    // Wrap only if regular error\n    if (!e.hasOwnProperty('apiResponse') && !e.hasOwnProperty('originalMessage')) {\n\n        e.apiResponse = apiResponse;\n        e.originalMessage = e.message;\n        e.message = (apiResponse && apiResponse.error(true)) || e.originalMessage;\n\n    }\n\n    return e;\n\n};\n\n/**\n *\n * @param {object} init\n * @param {object} [init.url]\n * @param {object} [init.body]\n * @param {string} [init.method]\n * @param {object} [init.query]\n * @param {object} [init.headers]\n * @param {object} [init.credentials]\n * @param {object} [init.mode]\n * @return {Request}\n */\nClient.prototype.createRequest = function(init) {\n\n    init = init || {};\n    init.headers = init.headers || {};\n\n    // Sanity checks\n    if (!init.url) throw new Error('Url is not defined');\n    if (!init.method) init.method = 'GET';\n    init.method = init.method.toUpperCase();\n    if (init.method && Client._allowedMethods.indexOf(init.method) < 0) {\n        throw new Error('Method has wrong value: ' + init.method);\n    }\n\n    // Defaults\n    init.credentials = init.credentials || 'include';\n    init.mode = init.mode || 'cors';\n\n    // Append Query String\n    if (init.query) {\n        init.url = init.url + (init.url.indexOf('?') > -1 ? '&' : '?') + qs.stringify(init.query);\n    }\n\n    if (!(findHeaderName('Accept', init.headers))) {\n        init.headers['Accept'] = ApiResponse._jsonContentType;\n    }\n\n    // Serialize body\n    if (isPlainObject(init.body) || !init.body) {\n\n        var contentTypeHeaderName = findHeaderName(ApiResponse._contentType, init.headers);\n\n        if (!contentTypeHeaderName) {\n            contentTypeHeaderName = ApiResponse._contentType;\n            init.headers[contentTypeHeaderName] = ApiResponse._jsonContentType;\n        }\n\n        var contentType = init.headers[contentTypeHeaderName];\n\n        // Assign a new encoded body\n        if (contentType.indexOf(ApiResponse._jsonContentType) > -1) {\n            if ((init.method === 'GET' || init.method === 'HEAD') && !!init.body) {\n                // oddly setting body to null still result in TypeError in phantomjs\n                init.body = undefined;\n            } else {\n                init.body = JSON.stringify(init.body);\n            }\n\n        } else if (contentType.indexOf(ApiResponse._urlencodedContentType) > -1) {\n            init.body = qs.stringify(init.body);\n        }\n\n    }\n\n    // Create a request with encoded body\n    var req = new this._externals.Request(init.url, init);\n\n    // Keep the original body accessible directly (for mocks)\n    req.originalBody = init.body;\n\n    return req;\n\n};\n\n/**\n * @typedef {object} IApiError\n * @property {string} stack\n * @property {string} originalMessage\n * @property {ApiResponse} apiResponse\n */\n\nmodule.exports = Client;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/http/Client.js\n ** module id = 3\n ** module chunks = 0 1\n **/","/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\n\nfunction isObjectObject(o) {\n  return isObject(o) === true\n    && Object.prototype.toString.call(o) === '[object Object]';\n}\n\nmodule.exports = function isPlainObject(o) {\n  var ctor,prot;\n  \n  if (isObjectObject(o) === false) return false;\n  \n  // If has modified constructor\n  ctor = o.constructor;\n  if (typeof ctor !== 'function') return false;\n  \n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObjectObject(prot) === false) return false;\n  \n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n  \n  // Most likely a plain Object\n  return true;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/is-plain-object/index.js\n ** module id = 4\n ** module chunks = 0 1\n **/","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object'\n    && !Array.isArray(val);\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/is-plain-object/~/isobject/index.js\n ** module id = 5\n ** module chunks = 0 1\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/events/events.js\n ** module id = 6\n ** module chunks = 0 1\n **/","/**\n * @param {Externals} options.externals\n * @param {Request} [options.request]\n * @param {Response} [options.response]\n * @param {string} [options.responseText]\n * @property {Externals} _externals\n * @property {Request} _request\n * @property {Response} _response\n * @property {string} _text\n * @property {object} _json\n * @property {ApiResponse[]} _multipart\n */\nfunction ApiResponse(options) {\n\n    /** @private */\n    this._externals = options.externals;\n\n    /** @private */\n    this._request = options.request;\n\n    /** @private */\n    this._response = options.response;\n\n    /** @private */\n    this._text = options.responseText || '';\n\n    /** @private */\n    this._json = null;\n\n    /** @private */\n    this._multipart = [];\n\n}\n\nApiResponse._contentType = 'Content-Type';\nApiResponse._jsonContentType = 'application/json';\nApiResponse._multipartContentType = 'multipart/mixed';\nApiResponse._urlencodedContentType = 'application/x-www-form-urlencoded';\nApiResponse._headerSeparator = ':';\nApiResponse._bodySeparator = '\\n\\n';\nApiResponse._boundarySeparator = '--';\nApiResponse._unauthorizedStatus = 401;\n\n/**\n * @param {Response} response\n * @return {Promise<ApiResponse>}\n */\nApiResponse.prototype.receiveResponse = function(response) {\n\n    this._response = response;\n\n    return (new this._externals.Promise(function(resolve) {\n\n        // Ignore if not textual type\n        if (!this._isMultipart() && !this._isJson()) return resolve('');\n\n        return resolve(this.response().text());\n\n    }.bind(this))).then(function(text) {\n\n        this._text = text;\n        return text;\n\n    }.bind(this));\n\n};\n\n/**\n * @return {Response}\n */\nApiResponse.prototype.response = function() {\n    return this._response;\n};\n\n/**\n * @return {Request}\n */\nApiResponse.prototype.request = function() {\n    return this._request;\n};\n\n/**\n * @return {boolean}\n */\nApiResponse.prototype.ok = function() {\n    return this._response && this._response.ok;\n};\n\n/**\n * @return {string}\n */\nApiResponse.prototype.text = function() {\n    // Since we read text only in case JSON or Multipart\n    if (!this._isJson() && !this._isMultipart()) throw new Error('Response is not text');\n    return this._text;\n};\n\n/**\n * @return {object}\n */\nApiResponse.prototype.json = function() {\n    if (!this._isJson()) throw new Error('Response is not JSON');\n    if (!this._json) {\n        this._json = this._text ? JSON.parse(this._text) : null;\n    }\n    return this._json;\n};\n\n/**\n * @param [skipOKCheck]\n * @return {string}\n */\nApiResponse.prototype.error = function(skipOKCheck) {\n\n    if (this.ok() && !skipOKCheck) return null;\n\n    var message = (this._response && this._response.status ? this._response.status + ' ' : '') +\n                  (this._response && this._response.statusText ? this._response.statusText : '');\n\n    try {\n\n        if (this.json().message) message = this.json().message;\n        if (this.json().error_description) message = this.json().error_description;\n        if (this.json().description) message = this.json().description;\n\n    } catch (e) {}\n\n    return message;\n\n};\n\n/**\n * If it is not known upfront what would be the response, client code can treat any response as multipart\n * @return {ApiResponse[]}\n */\nApiResponse.prototype.toMultipart = function() {\n    if (!this._isMultipart()) return [this];\n    return this.multipart();\n};\n\n/**\n * @return {ApiResponse[]}\n */\nApiResponse.prototype.multipart = function() {\n\n    if (!this._isMultipart()) throw new Error('Response is not multipart');\n\n    if (!this._multipart.length) {\n\n        // Step 1. Split multipart response\n\n        var text = this.text();\n\n        if (!text) throw new Error('No response body');\n\n        var boundary = this._getContentType().match(/boundary=([^;]+)/i)[1];\n\n        if (!boundary) throw new Error('Cannot find boundary');\n\n        var parts = text.toString().split(ApiResponse._boundarySeparator + boundary);\n\n        if (parts[0].trim() === '') parts.shift();\n        if (parts[parts.length - 1].trim() == ApiResponse._boundarySeparator) parts.pop();\n\n        if (parts.length < 1) throw new Error('No parts in body');\n\n        // Step 2. Parse status info\n\n        var statusInfo = this._create(parts.shift(), this._response.status, this._response.statusText).json();\n\n        // Step 3. Parse all other parts\n\n        this._multipart = parts.map(function(part, i) {\n\n            var status = statusInfo.response[i].status;\n\n            return this._create(part, status);\n\n        }.bind(this));\n\n    }\n\n    return this._multipart;\n\n};\n\n/**\n * @private\n */\nApiResponse.prototype._isContentType = function(contentType) {\n    return this._getContentType().indexOf(contentType) > -1;\n};\n\n/**\n * @private\n */\nApiResponse.prototype._getContentType = function() {\n    return this._response.headers.get(ApiResponse._contentType) || '';\n};\n\n/**\n * @private\n */\nApiResponse.prototype._isMultipart = function() {\n    return this._isContentType(ApiResponse._multipartContentType);\n};\n\n/**\n * @private\n */\nApiResponse.prototype._isJson = function() {\n    return this._isContentType(ApiResponse._jsonContentType);\n};\n\n/**\n * Method is used to create ApiResponse object from string parts of multipart/mixed response\n * @param {string} [text]\n * @param {number} [status]\n * @param {string} [statusText]\n * @private\n * @return {ApiResponse}\n */\nApiResponse.prototype._create = function(text, status, statusText) {\n\n    text = text || '';\n    status = status || 200;\n    statusText = statusText || 'OK';\n\n    text = text.replace(/\\r/g, '');\n\n    var headers = new this._externals.Headers(),\n        headersAndBody = text.split(ApiResponse._bodySeparator),\n        headersText = (headersAndBody.length > 1) ? headersAndBody.shift() : '';\n\n    text = headersAndBody.length > 0 ? headersAndBody.join(ApiResponse._bodySeparator) : null;\n\n    (headersText || '')\n        .split('\\n')\n        .forEach(function(header) {\n\n            var split = header.trim().split(ApiResponse._headerSeparator),\n                key = split.shift().trim(),\n                value = split.join(ApiResponse._headerSeparator).trim();\n\n            if (key) headers.append(key, value);\n\n        });\n\n    var response = new this._externals.Response(text, {\n        headers: headers,\n        status: status,\n        statusText: statusText\n    });\n\n    return new ApiResponse({\n        externals: this._externals,\n        request: null,\n        response: response,\n        responseText: text\n    });\n\n};\n\nmodule.exports = ApiResponse;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/http/ApiResponse.js\n ** module id = 7\n ** module chunks = 0 1\n **/","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/querystring/index.js\n ** module id = 8\n ** module chunks = 0 1\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (Array.isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/querystring/decode.js\n ** module id = 9\n ** module chunks = 0 1\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return Object.keys(obj).map(function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (Array.isArray(obj[k])) {\n        return obj[k].map(function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/querystring/encode.js\n ** module id = 10\n ** module chunks = 0 1\n **/","var pubnub = require(\"pubnub\");\nvar es6Promise = require(\"es6-promise\");\nvar FetchPonyfill = require(\"fetch-ponyfill\");\n\nvar root = (typeof window !== \"undefined\" && window) ||\n           (typeof global !== \"undefined\" && global) ||\n           (function(){ return this; })();\n\n/**\n * @constructor\n * @param {PUBNUB} [options.PUBNUB]\n * @param {function(new:Promise)} [options.Promise]\n * @param {Storage} [options.localStorage]\n * @param {fetch} [options.fetch]\n * @param {function(new:Request)} [options.Request]\n * @param {function(new:Response)} [options.Response]\n * @param {function(new:Headers)} [options.Headers]\n * @property {PUBNUB} PUBNUB\n * @property {Storage} localStorage\n * @property {function(new:Promise)} Promise\n * @property {fetch} fetch\n * @property {function(new:Request)} Request\n * @property {function(new:Response)} Response\n * @property {function(new:Headers)} Headers\n */\nfunction Externals(options) {\n\n    options = options || {};\n\n    this.PUBNUB = options.PUBNUB || root.PUBNUB || pubnub;\n    this.localStorage = options.localStorage || ((typeof root.localStorage !== 'undefined') ? root.localStorage : {});\n    this.Promise = options.Promise || root.Promise || (es6Promise && es6Promise.Promise);\n\n    var fetchPonyfill = FetchPonyfill ? FetchPonyfill({Promise: this.Promise}) : {};\n\n    this.fetch = options.fetch || root.fetch || fetchPonyfill.fetch;\n    this.Request = options.Request || root.Request || fetchPonyfill.Request;\n    this.Response = options.Response || root.Response || fetchPonyfill.Response;\n    this.Headers = options.Headers || root.Headers || fetchPonyfill.Headers;\n\n    if (!this.fetch || !this.Response || !this.Request || !this.Headers) {\n        throw new Error('Fetch API is missing');\n    }\n\n    if (!this.Promise) {\n        throw new Error('Promise is missing');\n    }\n\n    if (!this.localStorage) {\n        throw new Error('LocalStorage is missing');\n    }\n\n    if (!this.PUBNUB) {\n        throw new Error('PUBNUB is missing');\n    }\n\n}\n\nmodule.exports = Externals;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/core/Externals.js\n ** module id = 11\n ** module chunks = 0 1\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_12__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external {\"amd\":\"pubnub\"}\n ** module id = 12\n ** module chunks = 0 1\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_13__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"es6-promise\"\n ** module id = 13\n ** module chunks = 0 1\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_14__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fetch-ponyfill\"\n ** module id = 14\n ** module chunks = 0 1\n **/","var EventEmitter = require(\"events\").EventEmitter;\nvar qs = require(\"querystring\");\nvar objectAssign = require('object-assign');\nvar Auth = require(\"./Auth\");\nvar Constants = require(\"../core/Constants\");\nvar ApiResponse = require(\"../http/ApiResponse\");\n\n/**\n * @constructor\n * @param {string} options.server\n * @param {string} options.appSecret\n * @param {string} options.appKey\n * @param {string} [options.appName]\n * @param {string} [options.appVersion]\n * @param {string} [options.redirectUri]\n * @param {int} [options.refreshDelayMs]\n * @param {int} [options.refreshHandicapMs]\n * @param {boolean} [options.clearCacheOnRefreshError]\n * @param {Externals} options.externals\n * @param {Cache} options.cache\n * @param {Client} options.client\n * @property {Externals} _externals\n * @property {Cache} _cache\n * @property {Client} _client\n * @property {Promise<ApiResponse>} _refreshPromise\n * @property {Auth} _auth\n */\nfunction Platform(options) {\n\n    EventEmitter.call(this);\n\n    this.events = {\n        beforeLogin: 'beforeLogin',\n        loginSuccess: 'loginSuccess',\n        loginError: 'loginError',\n        beforeRefresh: 'beforeRefresh',\n        refreshSuccess: 'refreshSuccess',\n        refreshError: 'refreshError',\n        beforeLogout: 'beforeLogout',\n        logoutSuccess: 'logoutSuccess',\n        logoutError: 'logoutError'\n    };\n\n    options = options || {};\n\n    /** @private */\n    this._server = options.server;\n\n    /** @private */\n    this._appKey = options.appKey;\n\n    /** @private */\n    this._appSecret = options.appSecret;\n\n    /** @private */\n    this._redirectUri = options.redirectUri || '';\n\n    /** @private */\n    this._refreshDelayMs = options.refreshDelayMs || 100;\n\n    /** @private */\n    this._clearCacheOnRefreshError = typeof options.clearCacheOnRefreshError !== 'undefined'\n        ? options.clearCacheOnRefreshError\n        : true;\n\n    /** @private */\n    this._userAgent = (options.appName ?\n                      (options.appName + (options.appVersion ? '/' + options.appVersion : '')) + ' ' :\n                       '') +\n                      'RCJSSDK/' + Constants.version;\n\n    /** @private */\n    this._externals = options.externals;\n\n    /** @private */\n    this._cache = options.cache;\n\n    /** @private */\n    this._client = options.client;\n\n    /** @private */\n    this._refreshPromise = null;\n\n    /** @private */\n    this._auth = new Auth({\n        cache: this._cache,\n        cacheId: Platform._cacheId,\n        refreshHandicapMs: options.refreshHandicapMs\n    });\n\n}\n\nPlatform._urlPrefix = '/restapi';\nPlatform._apiVersion = 'v1.0';\nPlatform._tokenEndpoint = '/restapi/oauth/token';\nPlatform._revokeEndpoint = '/restapi/oauth/revoke';\nPlatform._authorizeEndpoint = '/restapi/oauth/authorize';\nPlatform._cacheId = 'platform';\n\nPlatform.prototype = Object.create(EventEmitter.prototype);\n\nPlatform.prototype.delay = function(timeout) {\n    return new this._externals.Promise(function(resolve, reject) {\n        setTimeout(function() {\n            resolve(null);\n        }, timeout);\n    });\n};\n\n/**\n * @return {Auth}\n */\nPlatform.prototype.auth = function() {\n    return this._auth;\n};\n\n/**\n * @return {Client}\n */\nPlatform.prototype.client = function() {\n    return this._client;\n};\n\n/**\n * @param {string} path\n * @param {object} [options]\n * @param {boolean} [options.addServer]\n * @param {string} [options.addMethod]\n * @param {boolean} [options.addToken]\n * @return {string}\n */\nPlatform.prototype.createUrl = function(path, options) {\n\n    path = path || '';\n    options = options || {};\n\n    var builtUrl = '',\n        hasHttp = path.indexOf('http://') != -1 || path.indexOf('https://') != -1;\n\n    if (options.addServer && !hasHttp) builtUrl += this._server;\n\n    if (path.indexOf(Platform._urlPrefix) == -1 && !hasHttp) builtUrl += Platform._urlPrefix + '/' + Platform._apiVersion;\n\n    builtUrl += path;\n\n    if (options.addMethod || options.addToken) builtUrl += (path.indexOf('?') > -1 ? '&' : '?');\n\n    if (options.addMethod) builtUrl += '_method=' + options.addMethod;\n    if (options.addToken) builtUrl += (options.addMethod ? '&' : '') + 'access_token=' + this._auth.accessToken();\n\n    return builtUrl;\n\n};\n\n/**\n * @param {string} [options.redirectUri] Overrides default RedirectURI\n * @param {string} [options.state]\n * @param {string} [options.brandId]\n * @param {string} [options.display]\n * @param {string} [options.prompt]\n * @param {boolean} [options.implicit] Use Implicit Grant flow\n * @return {string}\n */\nPlatform.prototype.loginUrl = function(options) {\n\n    options = options || {};\n\n    return this.createUrl(Platform._authorizeEndpoint + '?' + qs.stringify({\n            'response_type': options.implicit ? 'token' : 'code',\n            'redirect_uri': options.redirectUri || this._redirectUri,\n            'client_id': this._appKey,\n            'state': options.state || '',\n            'brand_id': options.brandId || '',\n            'display': options.display || '',\n            'prompt': options.prompt || ''\n        }), {addServer: true});\n\n};\n\n/**\n * @param {string} url\n * @return {Object}\n */\nPlatform.prototype.parseLoginRedirect = function(url) {\n\n    function getParts(url, separator) {\n        return url.split(separator).reverse()[0];\n    }\n\n    var response = (url.indexOf('#') === 0 && getParts(url, '#')) ||\n                   (url.indexOf('?') === 0 && getParts(url, '?')) ||\n                   null;\n\n    if (!response) throw new Error('Unable to parse response');\n\n    var queryString = qs.parse(response);\n\n    if (!queryString) throw new Error('Unable to parse response');\n\n    var error = queryString.error_description || queryString.error;\n\n    if (error) {\n        var e = new Error(error);\n        e.error = queryString.error;\n        throw e;\n    }\n\n    return queryString;\n\n};\n\n/**\n * Convenience method to handle 3-legged OAuth\n *\n * Attention! This is an experimental method and it's signature and behavior may change without notice.\n *\n * @experimental\n * @param {string} options.url\n * @param {number} [options.width]\n * @param {number} [options.height]\n * @param {object} [options.login] additional options for login()\n * @param {string} [options.origin]\n * @param {string} [options.property] name of window.postMessage's event data property\n * @param {string} [options.target] target for window.open()\n * @return {Promise}\n */\nPlatform.prototype.loginWindow = function(options) {\n\n    return new this._externals.Promise(function(resolve, reject) {\n\n        if (typeof window === 'undefined') throw new Error('This method can be used only in browser');\n\n        if (!options.url) throw new Error('Missing mandatory URL parameter');\n\n        options = options || {};\n        options.url = options.url || 400;\n        options.width = options.width || 400;\n        options.height = options.height || 600;\n        options.origin = options.origin || window.location.origin;\n        options.property = options.property || Constants.authResponseProperty;\n        options.target = options.target || '_blank';\n\n        var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n        var dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n\n        var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;\n        var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;\n\n        var left = ((width / 2) - (options.width / 2)) + dualScreenLeft;\n        var top = ((height / 2) - (options.height / 2)) + dualScreenTop;\n        var win = window.open(options.url, '_blank', (options.target == '_blank') ? 'scrollbars=yes, status=yes, width=' + options.width + ', height=' + options.height + ', left=' + left + ', top=' + top : '');\n\n        if (win.focus) win.focus();\n\n        var eventMethod = window.addEventListener ? 'addEventListener' : 'attachEvent';\n        var eventRemoveMethod = eventMethod == 'addEventListener' ? 'removeEventListener' : 'detachEvent';\n        var messageEvent = eventMethod == 'addEventListener' ? 'message' : 'onmessage';\n\n        var eventListener = function(e) {\n\n            try {\n\n                if (e.origin != options.origin) return;\n                if (!e.data || !e.data[options.property]) return; // keep waiting\n\n                win.close();\n                window[eventRemoveMethod](messageEvent, eventListener);\n\n\n                var loginOptions = this.parseLoginRedirect(e.data[options.property]);\n\n                if (!loginOptions.code && !loginOptions.access_token) throw new Error('No authorization code or token');\n\n                resolve(loginOptions);\n\n            /* jshint -W002 */\n            } catch (e) {\n                reject(e);\n            }\n\n        }.bind(this);\n\n        window[eventMethod](messageEvent, eventListener, false);\n\n    }.bind(this));\n\n};\n\n/**\n * @return {Promise<boolean>}\n */\nPlatform.prototype.loggedIn = function() {\n\n    return this.ensureLoggedIn().then(function() {\n        return true;\n    }).catch(function() {\n        return false;\n    });\n\n};\n\n/**\n * @param {string} options.username\n * @param {string} options.password\n * @param {string} [options.extension]\n * @param {string} [options.code]\n * @param {string} [options.redirectUri]\n * @param {string} [options.endpointId]\n * @param {string} [options.accessTokenTtl]\n * @param {string} [options.refreshTokenTtl]\n * @param {string} [options.access_token]\n * @returns {Promise<ApiResponse>}\n */\nPlatform.prototype.login = function(options) {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        options = options || {};\n\n        this.emit(this.events.beforeLogin);\n\n        var body = {};\n\n        if (options.access_token) {\n\n            //TODO Potentially make a request to /oauth/tokeninfo\n            return resolve(options);\n\n        }\n\n        if (!options.code) {\n\n            body.grant_type = 'password';\n            body.username = options.username;\n            body.password = options.password;\n            body.extension = options.extension || '';\n\n        } else if (options.code) {\n\n            body.grant_type = 'authorization_code';\n            body.code = options.code;\n            body.redirect_uri = options.redirectUri || this._redirectUri;\n            //body.client_id = this.getCredentials().key; // not needed\n\n        }\n\n        if (options.endpointId) body.endpoint_id = options.endpointId;\n        if (options.accessTokenTtl) body.accessTokenTtl = options.accessTokenTtl;\n        if (options.refreshTokenTtl) body.refreshTokenTtl = options.refreshTokenTtl;\n\n        resolve(this._tokenRequest(Platform._tokenEndpoint, body));\n\n    }.bind(this))).then(function(res) {\n\n        var apiResponse = res.json ? res : null;\n        var json = apiResponse && apiResponse.json() || res;\n\n        this._auth.setData(json);\n\n        this.emit(this.events.loginSuccess, apiResponse);\n\n        return apiResponse;\n\n    }.bind(this)).catch(function(e) {\n\n        if (this._clearCacheOnRefreshError) {\n            this._cache.clean();\n        }\n\n        this.emit(this.events.loginError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n * @private\n */\nPlatform.prototype._refresh = function() {\n\n    return this.delay(this._refreshDelayMs).then(function() {\n\n        this.emit(this.events.beforeRefresh);\n\n        // Perform sanity checks\n        if (!this._auth.refreshToken()) throw new Error('Refresh token is missing');\n        if (!this._auth.refreshTokenValid()) throw new Error('Refresh token has expired');\n\n        return this._tokenRequest(Platform._tokenEndpoint, {\n            \"grant_type\": \"refresh_token\",\n            \"refresh_token\": this._auth.refreshToken(),\n            \"access_token_ttl\": this._auth.data().expires_in + 1,\n            \"refresh_token_ttl\": this._auth.data().refresh_token_expires_in + 1\n        });\n\n    }.bind(this)).then(function(/** @type {ApiResponse} */ res) {\n\n        var json = res.json();\n\n        if (!json.access_token) {\n            throw this._client.makeError(new Error('Malformed OAuth response'), res);\n        }\n\n        this._auth.setData(json);\n\n        this.emit(this.events.refreshSuccess, res);\n\n        return res;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._client.makeError(e);\n\n        if (this._clearCacheOnRefreshError) {\n            this._cache.clean();\n        }\n\n        this.emit(this.events.refreshError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nPlatform.prototype.refresh = function() {\n\n    if (this._refreshPromise) {\n        return this._refreshPromise;\n    }\n\n    this._refreshPromise = this._refresh()\n        .then(function(res) {\n            this._refreshPromise = null;\n            return res;\n        }.bind(this))\n        .catch(function(e) {\n            this._refreshPromise = null;\n            throw e;\n        }.bind(this));\n\n    return this._refreshPromise;\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nPlatform.prototype.logout = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        this.emit(this.events.beforeLogout);\n\n        resolve(this._tokenRequest(Platform._revokeEndpoint, {\n            token: this._auth.accessToken()\n        }));\n\n    }.bind(this))).then(function(res) {\n\n        this._cache.clean();\n\n        this.emit(this.events.logoutSuccess, res);\n\n        return res;\n\n    }.bind(this)).catch(function(e) {\n\n        this.emit(this.events.logoutError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @param {Request} request\n * @param {object} [options]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<Request>}\n */\nPlatform.prototype.inflateRequest = function(request, options) {\n\n    options = options || {};\n\n    if (options.skipAuthCheck) return this._externals.Promise.resolve(request);\n\n    return this.ensureLoggedIn().then(function() {\n\n        request.headers.set('X-User-Agent', this._userAgent);\n        request.headers.set('Client-Id', this._appKey);\n        request.headers.set('Authorization', this._authHeader());\n        //request.url = this.createUrl(request.url, {addServer: true}); //FIXME Spec prevents this...\n\n        return request;\n\n    }.bind(this));\n\n};\n\n/**\n * @param {Request} request\n * @param {object} [options]\n * @param {boolean} [options.skipAuthCheck]\n * @param {boolean} [options.retry] Will be set by this method if SDK makes second request\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.sendRequest = function(request, options) {\n\n    return this.inflateRequest(request, options).then(function(request) {\n\n        options = options || {};\n\n        return this._client.sendRequest(request);\n\n    }.bind(this)).catch(function(e) {\n\n        // Guard is for errors that come from polling\n        if (!e.apiResponse || !e.apiResponse.response() ||\n            (e.apiResponse.response().status != ApiResponse._unauthorizedStatus) ||\n            options.retry) throw e;\n\n        this._auth.cancelAccessToken();\n\n        options.retry = true;\n\n        return this.sendRequest(request, options);\n\n    }.bind(this));\n\n};\n\n/**\n * General purpose function to send anything to server\n * @param {string} options.url\n * @param {object} [options.body]\n * @param {string} [options.method]\n * @param {object} [options.query]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.send = function(options) {\n\n    options = options || {};\n\n    //FIXME https://github.com/bitinn/node-fetch/issues/43\n    options.url = this.createUrl(options.url, {addServer: true});\n\n    return this.sendRequest(this._client.createRequest(options), options);\n\n};\n\n/**\n * @param {string} url\n * @param {object} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.get = function(url, query, options) {\n    return this.send(objectAssign({}, {method: 'GET', url: url, query: query}, options));\n};\n\n/**\n * @param {string} url\n * @param {object} body\n * @param {object} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.post = function(url, body, query, options) {\n    return this.send(objectAssign({}, {method: 'POST', url: url, query: query, body: body}, options));\n};\n\n/**\n * @param {string} url\n * @param {object} [body]\n * @param {object} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype.put = function(url, body, query, options) {\n    return this.send(objectAssign({}, {method: 'PUT', url: url, query: query, body: body}, options));\n};\n\n/**\n * @param {string} url\n * @param {string} [query]\n * @param {object} [options]\n * @param {object} [options.headers]\n * @param {boolean} [options.skipAuthCheck]\n * @return {Promise<ApiResponse>}\n */\nPlatform.prototype['delete'] = function(url, query, options) {\n    return this.send(objectAssign({}, {method: 'DELETE', url: url, query: query}, options));\n};\n\nPlatform.prototype.ensureLoggedIn = function() {\n    if (this._isAccessTokenValid()) return this._externals.Promise.resolve();\n    return this.refresh();\n};\n\n/**\n * @param path\n * @param body\n * @return {Promise.<ApiResponse>}\n * @private\n */\nPlatform.prototype._tokenRequest = function(path, body) {\n\n    return this.send({\n        url: path,\n        skipAuthCheck: true,\n        body: body,\n        method: 'POST',\n        headers: {\n            'Authorization': 'Basic ' + this._apiKey(),\n            'Content-Type': ApiResponse._urlencodedContentType\n        }\n    });\n\n};\n\n/**\n * @return {boolean}\n * @private\n */\nPlatform.prototype._isAccessTokenValid = function() {\n    return this._auth.accessTokenValid();\n};\n\n/**\n * @return {string}\n * @private\n */\nPlatform.prototype._apiKey = function() {\n    var apiKey = this._appKey + ':' + this._appSecret;\n    return (typeof btoa == 'function') ? btoa(apiKey) : new Buffer(apiKey).toString('base64');\n};\n\n/**\n * @return {string}\n * @private\n */\nPlatform.prototype._authHeader = function() {\n    var token = this._auth.accessToken();\n    return this._auth.tokenType() + (token ? ' ' + token : '');\n};\n\nmodule.exports = Platform;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/platform/Platform.js\n ** module id = 15\n ** module chunks = 0 1\n **/","/**\n * @param {Cache} options.cache\n * @param {string} options.cacheId\n * @param {int} [options.refreshHandicapMs]\n * @constructor\n * @property {Cache} _cache\n * @property {int} _refreshHandicapMs\n * @property {string} _cacheId\n */\nfunction Auth(options) {\n\n    /** @private */\n    this._cache = options.cache;\n\n    /** @private */\n    this._cacheId = options.cacheId;\n\n    /** @private */\n    this._refreshHandicapMs = options.refreshHandicapMs || 60 * 1000; // 1 minute\n\n}\n\nAuth.prototype.accessToken = function() {\n    return this.data().access_token;\n};\n\nAuth.prototype.refreshToken = function() {\n    return this.data().refresh_token;\n};\n\nAuth.prototype.tokenType = function() {\n    return this.data().token_type;\n};\n\n/**\n * @return {{token_type: string, access_token: string, expires_in: number, refresh_token: string, refresh_token_expires_in: number}}\n */\nAuth.prototype.data = function() {\n\n    return this._cache.getItem(this._cacheId) || {\n            token_type: '',\n            access_token: '',\n            expires_in: 0,\n            refresh_token: '',\n            refresh_token_expires_in: 0\n        };\n\n};\n\n/**\n * @param {object} newData\n * @return {Auth}\n */\nAuth.prototype.setData = function(newData) {\n\n    newData = newData || {};\n\n    var data = this.data();\n\n    Object.keys(newData).forEach(function(key) {\n        data[key] = newData[key];\n    });\n\n    data.expire_time = Date.now() + (data.expires_in * 1000);\n    data.refresh_token_expire_time = Date.now() + (data.refresh_token_expires_in * 1000);\n\n    this._cache.setItem(this._cacheId, data);\n\n    return this;\n\n};\n\n/**\n * Check if there is a valid (not expired) access token\n * @return {boolean}\n */\nAuth.prototype.accessTokenValid = function() {\n\n    var authData = this.data();\n    return (authData.expire_time - this._refreshHandicapMs > Date.now());\n\n};\n\n/**\n * Check if there is a valid (not expired) access token\n * @return {boolean}\n */\nAuth.prototype.refreshTokenValid = function() {\n\n    return (this.data().refresh_token_expire_time > Date.now());\n\n};\n\n/**\n * @return {Auth}\n */\nAuth.prototype.cancelAccessToken = function() {\n\n    return this.setData({\n        access_token: '',\n        expires_in: 0\n    });\n\n};\n\nmodule.exports = Auth;\n\n//export interface IAuthData {\n//    remember?:boolean;\n//    token_type?:string;\n//    access_token?:string;\n//    expires_in?:number; // actually it's string\n//    expire_time?:number;\n//    refresh_token?:string;\n//    refresh_token_expires_in?:number; // actually it's string\n//    refresh_token_expire_time?:number;\n//    scope?:string;\n//}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/platform/Auth.js\n ** module id = 16\n ** module chunks = 0 1\n **/","module.exports = {\n    version: require('../../package.json').version,\n    authResponseProperty: 'RCAuthorizationResponse'\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/core/Constants.js\n ** module id = 17\n ** module chunks = 0 1\n **/","module.exports = {\n\t\"name\": \"ringcentral\",\n\t\"version\": \"3.0.0-rc2\",\n\t\"scripts\": {\n\t\t\"clean\": \"rm -rf build/*\",\n\t\t\"build\": \"npm run clean && ./node_modules/.bin/webpack --display-modules --progress --colors --bail\",\n\t\t\"watch\": \"npm run build -- --watch\",\n\t\t\"test\": \"npm run hint && npm run build && npm run istanbul && npm run karma && npm run karma-webpack\",\n\t\t\"mocha\": \"mocha --require ./src/test/test.js ./src/**/*-spec.js\",\n\t\t\"mocha-watch\": \"npm run mocha -- --watch\",\n\t\t\"mocha-api\": \"mocha ./test-api/**/*-spec.js\",\n\t\t\"karma\": \"karma start karma.conf.js\",\n\t\t\"karma-watch\": \"npm run karma -- --no-single-run --auto-watch\",\n\t\t\"karma-webpack\": \"karma start karma.conf.webpack.js\",\n\t\t\"karma-webpack-watch\": \"npm run karma-webpack -- --no-single-run --auto-watch\",\n\t\t\"istanbul\": \"istanbul cover --dir=./build/coverage --report=lcov _mocha -- --require ./src/test/test.js --reporter spec ./src/**/*-spec.js\",\n\t\t\"tsd\": \"tsd reinstall -so\",\n\t\t\"start\": \"http-server -p 3030\",\n\t\t\"docs\": \"jsdoc2md 'src/**/*!(test).js' > API.md\",\n\t\t\"hint\": \"jshint src/**/*.js\"\n\t},\n\t\"dependencies\": {\n\t\t\"es6-promise\": \"^3.0.2\",\n\t\t\"fetch-ponyfill\": \"^3.0.0\",\n\t\t\"is-plain-object\": \"^2.0.1\",\n\t\t\"object-assign\": \"^4.1.0\",\n\t\t\"pubnub\": \"^3.16.3\"\n\t},\n\t\"devDependencies\": {\n\t\t\"chai\": \"^3.5.0\",\n\t\t\"fetch-mock\": \"^5.5.0\",\n\t\t\"http-server\": \"^0.9.0\",\n\t\t\"istanbul\": \"^0.4.1\",\n\t\t\"jsdoc-to-markdown\": \"^2.0.1\",\n\t\t\"jshint\": \"^2.9.4\",\n\t\t\"json-loader\": \"^0.5.4\",\n\t\t\"karma\": \"^0.13.22\",\n\t\t\"karma-chai-plugins\": \"^0.7.0\",\n\t\t\"karma-chrome-launcher\": \"^0.2.3\",\n\t\t\"karma-coverage\": \"^0.5.3\",\n\t\t\"karma-firefox-launcher\": \"^0.1.7\",\n\t\t\"karma-html-reporter\": \"^0.2.6\",\n\t\t\"karma-mocha\": \"^0.2.0\",\n\t\t\"karma-mocha-reporter\": \"^2.0.0\",\n\t\t\"karma-phantomjs-launcher\": \"^1.0.0\",\n\t\t\"karma-sourcemap-loader\": \"^0.3.5\",\n\t\t\"karma-webpack\": \"^1.7.0\",\n\t\t\"mocha\": \"^2.4.5\",\n\t\t\"phantomjs-prebuilt\": \"^2.1.7\",\n\t\t\"sinon\": \"^1.17.3\",\n\t\t\"sinon-chai\": \"^2.8.0\",\n\t\t\"soap\": \"^0.13.0\",\n\t\t\"virtual-module-webpack-plugin\": \"^0.1.1\",\n\t\t\"webpack\": \"^1.12.14\",\n\t\t\"whatwg-fetch\": \"^1.0.0\"\n\t},\n\t\"jsdoc2md\": {\n\t\t\"separators\": true,\n\t\t\"module-index-format\": \"grouped\",\n\t\t\"param-list-format\": \"table\",\n\t\t\"property-list-format\": \"table\"\n\t},\n\t\"jshintConfig\": {\n\t\t\"curly\": false,\n\t\t\"eqeqeq\": false,\n\t\t\"expr\": true,\n\t\t\"indent\": 4,\n\t\t\"latedef\": true,\n\t\t\"laxbreak\": true,\n\t\t\"plusplus\": false,\n\t\t\"shadow\": true,\n\t\t\"sub\": true\n\t},\n\t\"preferGlobal\": false,\n\t\"private\": false,\n\t\"main\": \"./src/SDK.js\",\n\t\"author\": {\n\t\t\"name\": \"RingCentral, Inc.\",\n\t\t\"email\": \"devsupport@ringcentral.com\"\n\t},\n\t\"contributors\": [\n\t\t{\n\t\t\t\"name\": \"Kirill Konshin\"\n\t\t}\n\t],\n\t\"repository\": {\n\t\t\"type\": \"git\",\n\t\t\"url\": \"git://github.com/ringcentral/ringcentral-js.git\"\n\t},\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/ringcentral/ringcentral-js/issues\"\n\t},\n\t\"homepage\": \"https://github.com/ringcentral/ringcentral-js\",\n\t\"engines\": {\n\t\t\"node\": \">=0.10.36\"\n\t},\n\t\"license\": \"MIT\"\n};\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./package.json\n ** module id = 18\n ** module chunks = 0 1\n **/","var EventEmitter = require(\"events\").EventEmitter;\n\n/**\n * @param {Platform} options.platform\n * @param {Externals} options.externals\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @property {Externals} _externals\n * @property {Platform} _platform\n * @property {int} _pollInterval\n * @property {int} _renewHandicapMs\n * @property {PUBNUB} _pubnub\n * @property {string} _pubnubLastChannel\n * @property {int} _timeout\n * @property {ISubscription} _subscription\n * @constructor\n */\nfunction Subscription(options) {\n\n    EventEmitter.call(this);\n\n    options = options || {};\n\n    this.events = {\n        notification: 'notification',\n        removeSuccess: 'removeSuccess',\n        removeError: 'removeError',\n        renewSuccess: 'renewSuccess',\n        renewError: 'renewError',\n        subscribeSuccess: 'subscribeSuccess',\n        subscribeError: 'subscribeError'\n    };\n\n    /** @private */\n    this._externals = options.externals;\n\n    /** @private */\n    this._platform = options.platform;\n\n    /** @private */\n    this._pollInterval = options.pollInterval || 10 * 1000;\n\n    /** @private */\n    this._renewHandicapMs = options.renewHandicapMs || 2 * 60 * 1000;\n\n    /** @private */\n    this._pubnub = null;\n\n    /** @private */\n    this._pubnubLastChannel = null;\n\n    /** @private */\n    this._timeout = null;\n\n    /** @private */\n    this._subscription = null;\n\n}\n\nSubscription.prototype = Object.create(EventEmitter.prototype);\n\nSubscription.prototype.subscribed = function() {\n\n    var subscription = this.subscription();\n\n    return !!(subscription.id &&\n              subscription.deliveryMode &&\n              subscription.deliveryMode.subscriberKey &&\n              subscription.deliveryMode.address);\n\n};\n\n/**\n * @return {boolean}\n */\nSubscription.prototype.alive = function() {\n    return this.subscribed() && Date.now() < this.expirationTime();\n};\n\n/**\n * @return {boolean}\n */\nSubscription.prototype.expired = function() {\n    if (!this.subscribed()) return true;\n    return !this.subscribed() || Date.now() > this.subscription().expirationTime;\n};\n\nSubscription.prototype.expirationTime = function() {\n    return new Date(this.subscription().expirationTime || 0).getTime() - this._renewHandicapMs;\n};\n\n/**\n * @param {ISubscription} subscription\n * @return {Subscription}\n */\nSubscription.prototype.setSubscription = function(subscription) {\n\n    subscription = subscription || {};\n\n    this._clearTimeout();\n    this._setSubscription(subscription);\n    this._subscribeAtPubnub();\n    this._setTimeout();\n\n    return this;\n\n};\n\n/**\n * @return {ISubscription}\n */\nSubscription.prototype.subscription = function() {\n    return this._subscription || {};\n};\n\n/**\n * Creates or updates subscription if there is an active one\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.register = function() {\n\n    if (this.alive()) {\n        return this.renew();\n    } else {\n        return this.subscribe();\n    }\n\n};\n\n/**\n * @return {string[]}\n */\nSubscription.prototype.eventFilters = function() {\n    return this.subscription().eventFilters || [];\n};\n\n/**\n * @param {string[]} events\n * @return {Subscription}\n */\nSubscription.prototype.addEventFilters = function(events) {\n    this.setEventFilters(this.eventFilters().concat(events));\n    return this;\n};\n\n/**\n * @param {string[]} events\n * @return {Subscription}\n */\nSubscription.prototype.setEventFilters = function(events) {\n    var subscription = this.subscription();\n    subscription.eventFilters = events;\n    this._setSubscription(subscription);\n    return this;\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.subscribe = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        this._clearTimeout();\n\n        if (!this.eventFilters().length) throw new Error('Events are undefined');\n\n        resolve(this._platform.post('/subscription', {\n            eventFilters: this._getFullEventFilters(),\n            deliveryMode: {\n                transportType: 'PubNub'\n            }\n        }));\n\n    }.bind(this))).then(function(response) {\n\n        var json = response.json();\n\n        this.setSubscription(json)\n            .emit(this.events.subscribeSuccess, response);\n\n        return response;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._platform.client().makeError(e);\n\n        this.reset()\n            .emit(this.events.subscribeError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.renew = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        this._clearTimeout();\n\n        if (!this.subscribed()) throw new Error('No subscription');\n\n        if (!this.eventFilters().length) throw new Error('Events are undefined');\n\n        resolve(this._platform.put('/subscription/' + this.subscription().id, {\n            eventFilters: this._getFullEventFilters()\n        }));\n\n    }.bind(this))).then(function(response) {\n\n        var json = response.json();\n\n        this.setSubscription(json)\n            .emit(this.events.renewSuccess, response);\n\n        return response;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._platform.client().makeError(e);\n\n        this.reset()\n            .emit(this.events.renewError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.remove = function() {\n\n    return (new this._externals.Promise(function(resolve) {\n\n        if (!this.subscribed()) throw new Error('No subscription');\n\n        resolve(this._platform.delete('/subscription/' + this.subscription().id));\n\n    })).then(function(response) {\n\n        this.reset()\n            .emit(this.events.removeSuccess, response);\n\n        return response;\n\n    }.bind(this)).catch(function(e) {\n\n        e = this._platform.client().makeError(e);\n\n        this.emit(this.events.removeError, e);\n\n        throw e;\n\n    }.bind(this));\n\n};\n\n/**\n * @returns {Promise<ApiResponse>}\n */\nSubscription.prototype.resubscribe = function() {\n    var filters = this.eventFilters();\n    return this.reset().setEventFilters(filters).subscribe();\n};\n\n/**\n * Remove subscription and disconnect from PUBNUB\n * This method resets subscription at client side but backend is not notified\n * @return {Subscription}\n */\nSubscription.prototype.reset = function() {\n    this._clearTimeout();\n    if (this.subscribed() && this._pubnub) this._pubnub.unsubscribe({channel: this.subscription().deliveryMode.address});\n    this._setSubscription(null);\n    return this;\n};\n\n/**\n * @param subscription\n * @private\n */\nSubscription.prototype._setSubscription = function(subscription) {\n    this._subscription = subscription;\n};\n\n/**\n * @return {string[]}\n * @private\n */\nSubscription.prototype._getFullEventFilters = function() {\n\n    return this.eventFilters().map(function(event) {\n        return this._platform.createUrl(event);\n    }.bind(this));\n\n};\n\n/**\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._setTimeout = function() {\n\n    this._clearTimeout();\n\n    if (!this.alive()) throw new Error('Subscription is not alive');\n\n    this._timeout = setInterval(function() {\n\n        if (this.alive()) return;\n\n        if (this.expired()) {\n            this.subscribe();\n        } else {\n            this.renew();\n        }\n\n    }.bind(this), this._pollInterval);\n\n    return this;\n\n};\n\n/**\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._clearTimeout = function() {\n    clearInterval(this._timeout);\n    return this;\n};\n\nSubscription.prototype._decrypt = function(message) {\n\n    if (!this.subscribed()) throw new Error('No subscription');\n\n    if (this.subscription().deliveryMode.encryptionKey) {\n\n        message = this._externals.PUBNUB.crypto_obj.decrypt(message, this.subscription().deliveryMode.encryptionKey, {\n            encryptKey: false,\n            keyEncoding: 'base64',\n            keyLength: 128,\n            mode: 'ecb'\n        });\n\n    }\n\n    return message;\n\n};\n\n/**\n * @param message\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._notify = function(message) {\n    this.emit(this.events.notification, this._decrypt(message));\n    return this;\n};\n\n/**\n * @return {Subscription}\n * @private\n */\nSubscription.prototype._subscribeAtPubnub = function() {\n\n    if (!this.alive()) throw new Error('Subscription is not alive');\n\n    var deliveryMode = this.subscription().deliveryMode;\n\n    if (this._pubnub) {\n\n        if (this._pubnubLastChannel == deliveryMode.address) { // Nothing to update, keep listening to same channel\n            return this;\n        } else if (this._pubnubLastChannel) { // Need to subscribe to new channel\n            this._pubnub.unsubscribe({channel: this._pubnubLastChannel});\n        }\n\n        // Re-init for new data\n        this._pubnub = this._pubnub.init({\n            ssl: true,\n            subscribe_key: deliveryMode.subscriberKey\n        });\n\n    } else {\n\n        // Init from scratch\n        this._pubnub = this._externals.PUBNUB.init({\n            ssl: true,\n            subscribe_key: deliveryMode.subscriberKey\n        });\n\n        this._pubnub.ready(); //TODO This may be not needed anymore\n\n    }\n\n    this._pubnubLastChannel = deliveryMode.address;\n\n    this._pubnub.subscribe({\n        channel: deliveryMode.address,\n        message: this._notify.bind(this),\n        connect: function() {}\n    });\n\n    return this;\n\n};\n\nmodule.exports = Subscription;\n\n/**\n * The complete Triforce, or one or more components of the Triforce.\n * @typedef {Object} ISubscription\n * @property {string} [id]\n * @property {string} [uri]\n * @property {string[]} [eventFilters]\n * @property {string} [expirationTime] Format: 2014-03-12T19:54:35.613Z\n * @property {int} [expiresIn]\n * @property {string} [deliveryMode.transportType]\n * @property {boolean} [deliveryMode.encryption]\n * @property {string} [deliveryMode.address]\n * @property {string} [deliveryMode.subscriberKey]\n * @property {string} [deliveryMode.encryptionKey]\n * @property {string} [deliveryMode.secretKey]\n * @property {string} [creationTime]\n * @property {string} [status] Active\n */\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/subscription/Subscription.js\n ** module id = 19\n ** module chunks = 0 1\n **/","var Subscription = require(\"./Subscription\");\n\n/**\n * @param {Platform} options.platform\n * @param {Externals} options.externals\n * @param {Cache} options.cache\n * @param {string} options.cacheKey\n * @param {int} [options.pollInterval]\n * @param {int} [options.renewHandicapMs]\n * @return {CachedSubscription}\n * @constructor\n * @property {Cache} _cache\n * @extends Subscription\n */\nfunction CachedSubscription(options) {\n\n    options = options || {};\n\n    if (!options.cacheKey) throw new Error('Cached Subscription requires cacheKey parameter to be defined');\n\n    /** @private */\n    this._cacheKey = options.cacheKey;\n\n    Subscription.call(this, options);\n\n    /** @private */\n    this._cache = options.cache;\n\n    // This is not used in this class\n    this._subscription = undefined;\n\n}\n\nCachedSubscription.prototype = Object.create(Subscription.prototype);\n\nCachedSubscription.prototype.subscription = function() {\n    return this._cache.getItem(this._cacheKey) || {};\n};\n\nCachedSubscription.prototype._setSubscription = function(subscription) {\n    return this._cache.setItem(this._cacheKey, subscription);\n};\n\n/**\n * This function checks whether there are any pre-defined eventFilters in cache and if not -- uses provided as defaults\n * @param {string[]} events\n * @return {CachedSubscription}\n */\nCachedSubscription.prototype.restore = function(events) {\n\n    if (!this.eventFilters().length) {\n        this.setEventFilters(events);\n    }\n\n    return this;\n\n};\n\nmodule.exports = CachedSubscription;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/subscription/CachedSubscription.js\n ** module id = 20\n ** module chunks = 0 1\n **/"],"sourceRoot":""}